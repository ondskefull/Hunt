(()=>{function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function n(e,t){return Object.keys(t).forEach((function(n){"default"===n||"__esModule"===n||e.hasOwnProperty(n)||Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})})),e}function r(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var o,i,s,a=o={};function c(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===c||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:c}catch(e){i=c}try{s="function"==typeof clearTimeout?clearTimeout:u}catch(e){s=u}}();var p,f,d,h,g=[],v=!1,y=-1;function m(){v&&p&&(v=!1,p.length?g=p.concat(g):y=-1,g.length&&b())}function b(){if(!v){var e=l(m);v=!0;for(var t=g.length;t;){for(p=g,g=[];++y<t;)p&&p[y].run();y=-1,t=g.length}p=null,v=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===u||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function w(e,t){this.fun=e,this.array=t}function S(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];g.push(new w(e,t)),1!==g.length||v||l(b)},w.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=S,a.addListener=S,a.once=S,a.off=S,a.removeListener=S,a.removeAllListeners=S,a.emit=S,a.prependListener=S,a.prependOnceListener=S,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0},function(e){!function(n){var r="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=s(e);function s(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=s(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return oe(Object.create(null))}:a?function(){return oe({__proto__:null})}:function(){return oe({})},has:c?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:c?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),p="object"==typeof o&&o.env&&!1,f=p||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?te():Map,d=p||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?ne():Set,h=new(p||"function"!=typeof WeakMap?re():WeakMap);function g(e,t,n,r){if(V(n)){if(!q(e))throw new TypeError;if(!z(t))throw new TypeError;return O(e,t)}if(!q(e))throw new TypeError;if(!U(t))throw new TypeError;if(!U(r)&&!V(r)&&!N(r))throw new TypeError;return N(r)&&(r=void 0),_(e,t,n=B(n),r)}function v(e,t){function n(n,r){if(!U(n))throw new TypeError;if(!V(r)&&!$(r))throw new TypeError;A(e,t,n,r)}return n}function y(e,t,n,r){if(!U(n))throw new TypeError;return V(r)||(r=B(r)),A(e,t,n,r)}function m(e,t,n){if(!U(t))throw new TypeError;return V(n)||(n=B(n)),k(e,t,n)}function b(e,t,n){if(!U(t))throw new TypeError;return V(n)||(n=B(n)),T(e,t,n)}function w(e,t,n){if(!U(t))throw new TypeError;return V(n)||(n=B(n)),P(e,t,n)}function S(e,t,n){if(!U(t))throw new TypeError;return V(n)||(n=B(n)),L(e,t,n)}function C(e,t){if(!U(e))throw new TypeError;return V(t)||(t=B(t)),j(e,t)}function I(e,t){if(!U(e))throw new TypeError;return V(t)||(t=B(t)),x(e,t)}function R(e,t,n){if(!U(t))throw new TypeError;V(n)||(n=B(n));var r=E(t,n,!1);if(V(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var o=h.get(t);return o.delete(n),o.size>0||h.delete(t),!0}function O(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!V(r)&&!N(r)){if(!z(r))throw new TypeError;t=r}}return t}function _(e,t,n,r){for(var o=e.length-1;o>=0;--o){var i=(0,e[o])(t,n,r);if(!V(i)&&!N(i)){if(!U(i))throw new TypeError;r=i}}return r}function E(e,t,n){var r=h.get(e);if(V(r)){if(!n)return;r=new f,h.set(e,r)}var o=r.get(t);if(V(o)){if(!n)return;o=new f,r.set(t,o)}return o}function k(e,t,n){if(T(e,t,n))return!0;var r=ee(t);return!N(r)&&k(e,r,n)}function T(e,t,n){var r=E(t,n,!1);return!V(r)&&W(r.has(e))}function P(e,t,n){if(T(e,t,n))return L(e,t,n);var r=ee(t);return N(r)?void 0:P(e,r,n)}function L(e,t,n){var r=E(t,n,!1);if(!V(r))return r.get(e)}function A(e,t,n,r){E(n,r,!0).set(e,t)}function j(e,t){var n=x(e,t),r=ee(e);if(null===r)return n;var o=j(r,t);if(o.length<=0)return n;if(n.length<=0)return o;for(var i=new d,s=[],a=0,c=n;a<c.length;a++){var u=c[a];i.has(u)||(i.add(u),s.push(u))}for(var l=0,p=o;l<p.length;l++){u=p[l];i.has(u)||(i.add(u),s.push(u))}return s}function x(e,t){var n=[],r=E(e,t,!1);if(V(r))return n;for(var o=K(r.keys()),i=0;;){var s=X(o);if(!s)return n.length=i,n;var a=J(s);try{n[i]=a}catch(e){try{Z(o)}finally{throw e}}i++}}function D(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function V(e){return void 0===e}function N(e){return null===e}function M(e){return"symbol"==typeof e}function U(e){return"object"==typeof e?null!==e:"function"==typeof e}function G(e,t){switch(D(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",o=Y(e,r);if(void 0!==o){var i=o.call(e,n);if(U(i))throw new TypeError;return i}return F(e,"default"===n?"number":n)}function F(e,t){if("string"===t){var n=e.toString;if(Q(n))if(!U(o=n.call(e)))return o;if(Q(r=e.valueOf))if(!U(o=r.call(e)))return o}else{var r;if(Q(r=e.valueOf))if(!U(o=r.call(e)))return o;var o,i=e.toString;if(Q(i))if(!U(o=i.call(e)))return o}throw new TypeError}function W(e){return!!e}function H(e){return""+e}function B(e){var t=G(e,3);return M(t)?t:H(t)}function q(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function Q(e){return"function"==typeof e}function z(e){return"function"==typeof e}function $(e){switch(D(e)){case 3:case 4:return!0;default:return!1}}function Y(e,t){var n=e[t];if(null!=n){if(!Q(n))throw new TypeError;return n}}function K(e){var t=Y(e,i);if(!Q(t))throw new TypeError;var n=t.call(e);if(!U(n))throw new TypeError;return n}function J(e){return e.value}function X(e){var t=e.next();return!t.done&&t}function Z(e){var t=e.return;t&&t.call(e)}function ee(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var o=r.constructor;return"function"!=typeof o||o===e?t:o}function te(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,o=n+1;o<r;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function s(e,t){return[e,t]}}function ne(){return function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}()}function re(){var e=16,n=u.create(),r=o();return function(){function e(){this._key=o()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=o()},e}();function o(){var e;do{e="@@WeakMap@@"+c()}while(u.has(n,e));return n[e]=!0,e}function i(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:u.create()})}return e[r]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function c(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var o=t[r];4!==r&&6!==r&&8!==r||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}function oe(e){return e.__=void 0,delete e.__,e}e("decorate",g),e("metadata",v),e("defineMetadata",y),e("hasMetadata",m),e("hasOwnMetadata",b),e("getMetadata",w),e("getOwnMetadata",S),e("getMetadataKeys",C),e("getOwnMetadataKeys",I),e("deleteMetadata",R)}(i)}()}(f||(f={})),(h=d||(d={}))[h.Transient=0]="Transient",h[h.Singleton=1]="Singleton",h[h.ResolutionScoped=2]="ResolutionScoped",h[h.ContainerScoped=3]="ContainerScoped";var C=d,I=function(e,t){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},I(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function R(e,t){function n(){this.constructor=e}I(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function O(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function _(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function E(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function k(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function T(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(k(arguments[t]));return e}var P="injectionTokens";function L(e){var t=Reflect.getMetadata("design:paramtypes",e)||[],n=Reflect.getOwnMetadata(P,e)||{};return Object.keys(n).forEach((function(e){t[+e]=n[e]})),t}function A(e,t){return function(n,r,o){var i=Reflect.getOwnMetadata(P,n)||{};i[o]=t?{token:e,transform:t.transformToken,transformArgs:t.args||[]}:e,Reflect.defineMetadata(P,i,n)}}function j(e){return!!e.useClass}function x(e){return!!e.useFactory}var D=function(){function e(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return e.prototype.createProxy=function(e){var t,n=this,r=!1;return new Proxy({},this.createHandler((function(){return r||(t=e(n.wrap()),r=!0),t})))},e.prototype.createHandler=function(e){var t={};return this.reflectMethods.forEach((function(n){t[n]=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t[0]=e(),Reflect[n].apply(void 0,T(t))}})),t},e}();function V(e){return"string"==typeof e||"symbol"==typeof e}function N(e){return"object"==typeof e&&"token"in e&&"multiple"in e}function M(e){return"object"==typeof e&&"token"in e&&"transform"in e}function U(e){return"function"==typeof e||e instanceof D}function G(e){return!!e.useToken}function F(e){return null!=e.useValue}function W(e){return j(e)||F(e)||G(e)||x(e)}var H=function(){function e(){this._registryMap=new Map}return e.prototype.entries=function(){return this._registryMap.entries()},e.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},e.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},e.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},e.prototype.setAll=function(e,t){this._registryMap.set(e,t)},e.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},e.prototype.clear=function(){this._registryMap.clear()},e.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},e}(),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return R(t,e),t}(H),q=function(){this.scopedResolutions=new Map};function Q(e,t,n){var r,o,i=k(e.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1],s=function(e,t){return null===e?"at position #"+t:'"'+e.split(",")[t].trim()+'" at position #'+t}(void 0===i?null:i,t);return r="Cannot inject the dependency "+s+' of "'+e.name+'" constructor. Reason:',void 0===o&&(o="    "),T([r],n.message.split("\n").map((function(e){return o+e}))).join("\n")}var z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return R(t,e),t}(H),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return R(t,e),t}(H),Y=function(){this.preResolution=new z,this.postResolution=new $},K=new Map,J=new(function(){function e(e){this.parent=e,this._registry=new B,this.interceptors=new Y,this.disposed=!1,this.disposables=new Set}return e.prototype.register=function(e,t,n){var r;if(void 0===n&&(n={lifecycle:C.Transient}),this.ensureNotDisposed(),G(r=W(t)?t:{useClass:t}))for(var o=[e],i=r;null!=i;){var s=i.useToken;if(o.includes(s))throw new Error("Token registration cycle detected! "+T(o,[s]).join(" -> "));o.push(s);var a=this._registry.get(s);i=a&&G(a.provider)?a.provider:null}if((n.lifecycle===C.Singleton||n.lifecycle==C.ContainerScoped||n.lifecycle==C.ResolutionScoped)&&(F(r)||x(r)))throw new Error('Cannot use lifecycle "'+C[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:r,options:n}),this},e.prototype.registerType=function(e,t){return this.ensureNotDisposed(),V(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},e.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},e.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),V(e)){if(V(t))return this.register(e,{useToken:t},{lifecycle:C.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:C.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!V(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:C.Singleton})},e.prototype.resolve=function(e,t){void 0===t&&(t=new q),this.ensureNotDisposed();var n=this.getRegistration(e);if(!n&&V(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"Single"),n){var r=this.resolveRegistration(n,t);return this.executePostResolutionInterceptor(e,r,"Single"),r}if(U(e)){r=this.construct(e,t);return this.executePostResolutionInterceptor(e,r,"Single"),r}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},e.prototype.executePreResolutionInterceptor=function(e,t){var n,r;if(this.interceptors.preResolution.has(e)){var o=[];try{for(var i=E(this.interceptors.preResolution.getAll(e)),s=i.next();!s.done;s=i.next()){var a=s.value;"Once"!=a.options.frequency&&o.push(a),a.callback(e,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,o)}},e.prototype.executePostResolutionInterceptor=function(e,t,n){var r,o;if(this.interceptors.postResolution.has(e)){var i=[];try{for(var s=E(this.interceptors.postResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var c=a.value;"Once"!=c.options.frequency&&i.push(c),c.callback(e,t,n)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}this.interceptors.postResolution.setAll(e,i)}},e.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===C.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n,r=e.options.lifecycle===C.Singleton,o=e.options.lifecycle===C.ContainerScoped,i=r||o;return n=F(e.provider)?e.provider.useValue:G(e.provider)?i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):j(e.provider)?i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):x(e.provider)?e.provider.useFactory(this):this.construct(e.provider,t),e.options.lifecycle===C.ResolutionScoped&&t.scopedResolutions.set(e,n),n},e.prototype.resolveAll=function(e,t){var n=this;void 0===t&&(t=new q),this.ensureNotDisposed();var r=this.getAllRegistrations(e);if(!r&&V(e))throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"');if(this.executePreResolutionInterceptor(e,"All"),r){var o=r.map((function(e){return n.resolveRegistration(e,t)}));return this.executePostResolutionInterceptor(e,o,"All"),o}var i=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,i,"All"),i},e.prototype.isRegistered=function(e,t){return void 0===t&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},e.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},e.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=E(this._registry.entries()),r=n.next();!r.done;r=n.next()){var o=k(r.value,2),i=o[0],s=o[1];this._registry.setAll(i,s.filter((function(e){return!F(e.provider)})).map((function(e){return e.instance=void 0,e})))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.createChildContainer=function(){var t,n;this.ensureNotDisposed();var r=new e(this);try{for(var o=E(this._registry.entries()),i=o.next();!i.done;i=o.next()){var s=k(i.value,2),a=s[0],c=s[1];c.some((function(e){return e.options.lifecycle===C.ContainerScoped}))&&r._registry.setAll(a,c.map((function(e){return e.options.lifecycle===C.ContainerScoped?{provider:e.provider,options:e.options}:e})))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.beforeResolution=function(e,t,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},e.prototype.afterResolution=function(e,t,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},e.prototype.dispose=function(){return O(this,void 0,void 0,(function(){var e;return _(this,(function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach((function(t){var n=t.dispose();n&&e.push(n)})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},e.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},e.prototype.construct=function(e,t){var n=this;if(e instanceof D)return e.createProxy((function(e){return n.resolve(e,t)}));var r,o=function(){var r=K.get(e);if(!r||0===r.length){if(0===e.length)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=r.map(n.resolveParams(t,e));return new(e.bind.apply(e,T([void 0],o)))}();return"function"!=typeof(r=o).dispose||r.dispose.length>0||this.disposables.add(o),o},e.prototype.resolveParams=function(e,t){var n=this;return function(r,o){var i,s,a;try{return N(r)?M(r)?r.multiple?(i=n.resolve(r.transform)).transform.apply(i,T([n.resolveAll(r.token)],r.transformArgs)):(s=n.resolve(r.transform)).transform.apply(s,T([n.resolve(r.token,e)],r.transformArgs)):r.multiple?n.resolveAll(r.token):n.resolve(r.token,e):M(r)?(a=n.resolve(r.transform,e)).transform.apply(a,T([n.resolve(r.token,e)],r.transformArgs)):n.resolve(r,e)}catch(e){throw new Error(Q(t,o,e))}}},e.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},e}());var X=function(e){return A(e)};var Z=function(){return function(e){K.set(e,L(e))}};var ee=function(){return function(e){Z()(e),J.registerSingleton(e)}};var te=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return A(e,{transformToken:t,args:n})};if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");var ne={};ne=function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function t(n,r){function o(t,o,i){if("undefined"!=typeof document){"number"==typeof(i=e({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a].split(";")[0]));return document.cookie=t+"="+n.write(o,t)+s}}function i(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],r={},o=0;o<t.length;o++){var i=t[o].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(r[a]=n.read(s,a),e===a)break}catch(e){}}return e?r[e]:r}}return Object.create({set:o,get:i,remove:function(t,n){o(t,"",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(n)}})}return t({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}();var re={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let oe;const ie=new Uint8Array(16);function se(){if(!oe&&(oe="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!oe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oe(ie)}const ae=[];for(let e=0;e<256;++e)ae.push((e+256).toString(16).slice(1));function ce(e,t=0){return(ae[e[t+0]]+ae[e[t+1]]+ae[e[t+2]]+ae[e[t+3]]+"-"+ae[e[t+4]]+ae[e[t+5]]+"-"+ae[e[t+6]]+ae[e[t+7]]+"-"+ae[e[t+8]]+ae[e[t+9]]+"-"+ae[e[t+10]]+ae[e[t+11]]+ae[e[t+12]]+ae[e[t+13]]+ae[e[t+14]]+ae[e[t+15]]).toLowerCase()}var ue=function(e,t,n){if(re.randomUUID&&!t&&!e)return re.randomUUID();const r=(e=e||{}).random||(e.rng||se)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return ce(r)},le={};r(le,"QueryString",(()=>Fe));var pe={};r(pe,"Browser",(()=>de),(e=>de=e));var fe=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},de=function(){function e(){}return e.prototype.getBrowser=function(){var e,t,n=(e=window.navigator).appName,r=e.appVersion,o=e.userAgent,i=o.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?(t=/\brv[ :]+(\d+)/g.exec(o)||[""],"IE ".concat(t[1]||"")):"Chrome"===i[1]&&null!==(t=o.match(/\b(OPR|Edg)\/(\d+)/))?t.slice(1).join(" ").replace("OPR","Opera").replace("Edg","Edge"):(i=i[2]?[i[1],i[2]]:[n,r,"-?"],null!==(t=o.match(/version\/(\d+)/i))&&i.splice(1,1,t[1]),i.join(" "))},e=fe([ee()],e)}(),he={};r(he,"Device",(()=>xe),(e=>xe=e));var ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve=window.device,ye={},me=[];window.device=ye;var be=window.document.documentElement,we=window.navigator.userAgent.toLowerCase(),Se=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","pov_tv","hbbtv","ce-html"];function Ce(e,t){return-1!==e.indexOf(t)}function Ie(e){return Ce(we,e)}function Re(e){return be.className.match(new RegExp(e,"i"))}function Oe(e){var t=null;Re(e)||(t=be.className.replace(/^\s+|\s+$/g,""),be.className=t+" "+e)}function _e(e){Re(e)&&(be.className=be.className.replace(" "+e,""))}function Ee(){ye.landscape()?(_e("portrait"),Oe("landscape"),ke("landscape")):(_e("landscape"),Oe("portrait"),ke("portrait")),Le()}function ke(e){for(var t=0;t<me.length;t++)me[t](e)}ye.macos=function(){return Ie("mac")},ye.ios=function(){return ye.iphone()||ye.ipod()||ye.ipad()},ye.iphone=function(){return!ye.windows()&&Ie("iphone")},ye.ipod=function(){return Ie("ipod")},ye.ipad=function(){var e="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;return Ie("ipad")||e},ye.android=function(){return!ye.windows()&&Ie("android")},ye.androidPhone=function(){return ye.android()&&Ie("mobile")},ye.androidTablet=function(){return ye.android()&&!Ie("mobile")},ye.blackberry=function(){return Ie("blackberry")||Ie("bb10")},ye.blackberryPhone=function(){return ye.blackberry()&&!Ie("tablet")},ye.blackberryTablet=function(){return ye.blackberry()&&Ie("tablet")},ye.windows=function(){return Ie("windows")},ye.windowsPhone=function(){return ye.windows()&&Ie("phone")},ye.windowsTablet=function(){return ye.windows()&&Ie("touch")&&!ye.windowsPhone()},ye.fxos=function(){return(Ie("(mobile")||Ie("(tablet"))&&Ie(" rv:")},ye.fxosPhone=function(){return ye.fxos()&&Ie("mobile")},ye.fxosTablet=function(){return ye.fxos()&&Ie("tablet")},ye.meego=function(){return Ie("meego")},ye.cordova=function(){return window.cordova&&"file:"===location.protocol},ye.nodeWebkit=function(){return"object"===ge(window.process)},ye.mobile=function(){return ye.androidPhone()||ye.iphone()||ye.ipod()||ye.windowsPhone()||ye.blackberryPhone()||ye.fxosPhone()||ye.meego()},ye.tablet=function(){return ye.ipad()||ye.androidTablet()||ye.blackberryTablet()||ye.windowsTablet()||ye.fxosTablet()},ye.desktop=function(){return!ye.tablet()&&!ye.mobile()},ye.television=function(){for(var e=0;e<Se.length;){if(Ie(Se[e]))return!0;e++}return!1},ye.portrait=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?Ce(screen.orientation.type,"portrait"):ye.ios()&&Object.prototype.hasOwnProperty.call(window,"orientation")?90!==Math.abs(window.orientation):window.innerHeight/window.innerWidth>1},ye.landscape=function(){return screen.orientation&&Object.prototype.hasOwnProperty.call(window,"onorientationchange")?Ce(screen.orientation.type,"landscape"):ye.ios()&&Object.prototype.hasOwnProperty.call(window,"orientation")?90===Math.abs(window.orientation):window.innerHeight/window.innerWidth<1},ye.noConflict=function(){return window.device=ve,this},ye.ios()?ye.ipad()?Oe("ios ipad tablet"):ye.iphone()?Oe("ios iphone mobile"):ye.ipod()&&Oe("ios ipod mobile"):ye.macos()?Oe("macos desktop"):ye.android()?ye.androidTablet()?Oe("android tablet"):Oe("android mobile"):ye.blackberry()?ye.blackberryTablet()?Oe("blackberry tablet"):Oe("blackberry mobile"):ye.windows()?ye.windowsTablet()?Oe("windows tablet"):ye.windowsPhone()?Oe("windows mobile"):Oe("windows desktop"):ye.fxos()?ye.fxosTablet()?Oe("fxos tablet"):Oe("fxos mobile"):ye.meego()?Oe("meego mobile"):ye.nodeWebkit()?Oe("node-webkit"):ye.television()?Oe("television"):ye.desktop()&&Oe("desktop"),ye.cordova()&&Oe("cordova"),ye.onChangeOrientation=function(e){"function"==typeof e&&me.push(e)};var Te="resize";function Pe(e){for(var t=0;t<e.length;t++)if(ye[e[t]]())return e[t];return"unknown"}function Le(){ye.orientation=Pe(["portrait","landscape"])}Object.prototype.hasOwnProperty.call(window,"onorientationchange")&&(Te="orientationchange"),window.addEventListener?window.addEventListener(Te,Ee,!1):window.attachEvent?window.attachEvent(Te,Ee):window[Te]=Ee,Ee(),ye.type=Pe(["mobile","tablet","desktop"]),ye.os=Pe(["ios","iphone","ipad","ipod","android","blackberry","macos","windows","fxos","meego","television"]),Le();var Ae=ye,je=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},xe=function(){function e(){}return e.prototype.getDeviceType=function(){return Ae.tablet()?"tablet":Ae.mobile()?"smartphone":"desktop"},e=je([ee()],e)}(),De={};r(De,"HttpClient",(()=>Ue),(e=>Ue=e));var Ve=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ne=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Me=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},Ue=function(){function e(){}return e.prototype.get=function(e){return Ne(this,void 0,Promise,(function(){return Me(this,(function(t){return[2,fetch(e,{method:"GET",mode:"cors"})]}))}))},e=Ve([Z()],e)}(),Ge={};r(Ge,"LoggerTransformer",(()=>He),(e=>He=e)),r(Ge,"Logger",(()=>Be),(e=>Be=e));var Fe=function(){function e(){}return e.getURLSearchParams=function(){var e=window.location.search.substring(1);return new URLSearchParams(e)},e.get=function(t){return e.getURLSearchParams().get(t)},e.stringify=function(e){var t=new URLSearchParams(e);return t.sort(),t.toString()},e}(),We=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},He=function(){function e(){}return e.prototype.transform=function(e,t){return e.setLoggerGroup(t)},e}(),Be=function(){function e(){this.logGroup="Global",this.debugGroup=this.getDebugGroup()||"",this.groups=this.debugGroup.split(","),this.INIT_TIME=Date.now()}return e.prototype.setLoggerGroup=function(e){return this.logGroup=e,this},e.prototype.getDebugGroup=function(){return Fe.get("identity_debug")},e.prototype.getTimeDelta=function(){return((Date.now()-this.INIT_TIME)/1e3).toFixed(4)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];""!==this.debugGroup&&("1"!==this.debugGroup&&-1===this.groups.indexOf(this.logGroup)||console.info("".concat(this.getTimeDelta(),"s\t\t ").concat(this.logGroup),e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];""!==this.debugGroup&&("1"!==this.debugGroup&&-1===this.groups.indexOf(this.logGroup)||console.error("".concat(this.getTimeDelta(),"s\t\t ").concat(this.logGroup),e))},e=We([Z()],e)}(),qe={};r(qe,"Platform",(()=>ze),(e=>ze=e));var Qe=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ze=function(){function e(){}return e.prototype.get=function(){var e,t,n,r=Fe.get("identity_icbm_app");return r||(void 0!==window.mw&&void 0!==(null===(n=null===(t=null===(e=window.ads)||void 0===e?void 0:e.context)||void 0===t?void 0:t.opts)||void 0===n?void 0:n.platformName)?window.ads.context.opts.platformName:this.checkHostname())},e.prototype.checkHostname=function(){var e,t=(e=window.location).hostname,n=e.pathname;switch(!0){case t.includes("fandom"):return t.includes("bingebot")?"bingebot":"f2";case t.includes("futhead"):return"futhead";case t.includes("muthead"):return"muthead";case t.includes("gamespot"):return t.includes("comicvine")?"comicvine":t.includes("gamefaqs")?"gamefaqs":"gamespot";case t.includes("metacritic"):return n.includes("news")?"metacritic-neutron":"metacritic";case t.includes("tvguide"):return"tvguide";case t.includes("giantbomb"):return"giantbomb";default:return"fandomdesktop"}},e=Qe([ee()],e)}(),$e={};r($e,"ServiceBaseUrl",(()=>Ke),(e=>Ke=e));var Ye=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ke=function(){function e(){}return e.prototype.get=function(){return["fandom.com","muthead.com","futhead.com"].find((function(e){return window.location.hostname.includes(e)}))?"https://services.fandom.com/":"https://services.fandom-dev."+(location.hostname.match(/(?!\.)(pl|us)$/)||["us"])[0]+"/"},e=Ye([ee()],e)}(),Je={};r(Je,"Storage",(()=>Ze),(e=>Ze=e));var Xe=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ze=function(){function e(){}return e.prototype.getItem=function(e){var t=window.localStorage.getItem(e);try{t=JSON.parse(t)}catch(e){return t}return t},e.prototype.setItem=function(e,t){var n=t instanceof Object?JSON.stringify(t):t;window.localStorage.setItem(e,n)},e.prototype.removeItem=function(e){return window.localStorage.removeItem(e)},e=Xe([ee()],e)}(),et={};r(et,"TopLevelDomainExtractor",(()=>nt),(e=>nt=e));var tt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},nt=function(){function e(){}return e.extract=function(e){var t=e.split(".");if(t.length<2)return e;var n=".".concat(t[t.length-2],".").concat(t[t.length-1]);return[".co.jp",".co.nz",".co.uk"].indexOf(n)>=0&&(n=".".concat(t[t.length-3]).concat(n)),n},e=tt([Z()],e)}(),rt={};r(rt,"WikiConfig",(()=>at),(e=>at=e));var ot=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},it=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},st=function(e,t){return function(n,r){t(n,r,e)}},at=function(){function e(e){this.window=e}var t;return e.prototype.get=function(e){var t,n,r;return null!==(r=null===(n=null===(t=this.window.mw)||void 0===t?void 0:t.config)||void 0===n?void 0:n.get(e))&&void 0!==r?r:null},e=ot([ee(),st(0,X("window")),it("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object])],e)}();n(le,pe),n(le,he),n(le,De),n(le,Ge),n(le,qe),n(le,$e),n(le,Je),n(le,et),n(le,rt);var ct={},ut={};r(ut,"BeaconGenerator",(()=>pt),(e=>pt=e));var lt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},pt=function(){function e(){}return e.prototype.generate=function(){for(var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-",t="";t.length<10;)t+=e[Math.random()*e.length|0];return t},e=lt([Z()],e)}(),ft={},dt={};r(dt,"DataWarehouseEventType",(()=>Bo),(e=>Bo=e)),r(dt,"DataWarehouseService",(()=>ei),(e=>ei=e));var ht={};r(ht,"IdentityEventSender",(()=>Ko),(e=>Ko=e));var gt={};r(gt,"Skin",(()=>bt),(e=>bt=e));var vt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},yt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mt=function(e,t){return function(n,r){t(n,r,e)}},bt=function(){function e(e,t){this.platform=e,this.device=t,this.skinMap={muthead:"turf",futhead:"turf",giantbomb:"giantbomb",gamefaqs:"gamefaqs",gamespot:"gamespot",metacritic:"metacritic","metacritic-neutron":"metacritic_neutron",comicvine:"comicvine",f2:"fandom",tvguide:"tvguide",fandomdesktop:"ucp",fandommobile:"ucp"}}var t,n;return e.prototype.get=function(){var e=this.platform.get(),t="desktop"===this.device.getDeviceType()?"desktop":"mobile";return this.skinMap[e]?this.skinMap[e]+"_"+t:"unknown"},e=vt([ee(),mt(0,X(qe.Platform)),mt(1,X(he.Device)),yt("design:paramtypes",["function"==typeof(t=void 0!==qe.Platform&&qe.Platform)?t:Object,"function"==typeof(n=void 0!==he.Device&&he.Device)?n:Object])],e)}(),wt={},St={};r(St,"ConsentResolver",(()=>It),(e=>It=e));var Ct=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},It=function(){function e(){}return e.prototype.resolve=function(e,t,n){e.geoRequiresConsent&&e.gdprConsent||e.geoRequiresSignal&&!e.ccpaSignal||!e.geoRequiresSignal&&!e.geoRequiresConsent?t():(e.geoRequiresSignal&&e.ccpaSignal||e.geoRequiresConsent&&!e.gdprConsent)&&n()},e=Ct([Z()],e)}(),Rt={};r(Rt,"OneTrust",(()=>qt),(e=>qt=e));var Ot,_t,Et,kt,Tt,Pt,Lt,At,jt,xt,Dt,Vt,Nt,Mt,Ut,Gt,Ft=["ai","aw","ax","at","be","bg","bm","vg","bq","ky","hr","cw","cy","cz","dk","ee","fk","fo","fi","fr","gf","pf","tf","de","gi","gr","gl","gp","hu","is","ie","im","it","re","lv","li","lt","lu","mq","mt","yt","ms","nl","nc","no","pn","pl","pt","ro","bl","sh","mf","pm","bq","sx","sk","si","es","se","ch","tc","gb","uk","wf"],Wt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ht=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bt=function(e,t){return function(n,r){t(n,r,e)}},qt=function(){function e(e,t){var n=this;this.cookiesManager=e,this.window=t,this.trackingGroup="C0004:1",this.consentGiven=new Promise((function(e){return n.resolveConsent=e})),this.oneTrustModalClosed()&&this.consentsUpdated(),"us"===this.getLocation()&&this.consentsUpdated(),this.subscribe()}var t,n;return e.prototype.getLocation=function(){var e,t;if(this.window.OneTrust&&this.window.OneTrust.getGeolocationData())return null===(e=this.window.OneTrust.getGeolocationData().country)||void 0===e?void 0:e.toLowerCase();var n=this.cookiesManager.get("Geo");return n?null===(t=JSON.parse(n))||void 0===t?void 0:t.country.toLowerCase():void 0},e.prototype.oneTrustModalClosed=function(){var e=this.cookiesManager.get("OptanonAlertBoxClosed");return e&&!!e},e.prototype.subscribe=function(){var e=this,t=this.window.OptanonWrapper;this.window.OptanonWrapper=function(){(e.oneTrustModalClosed()||"us"===e.getLocation())&&(e.consentsUpdated(),null==t||t())}},e.prototype.oneTrustCookieExists=function(){return!!this.cookiesManager.get("OptanonConsent")},e.prototype.readTrackingConsents=function(){var e,t=this.cookiesManager.get("OptanonConsent"),n=(null===(e=null==t?void 0:t.split("groups=").pop())||void 0===e?void 0:e.split(";")[0])||"";return n.length&&t.includes("groups")?n.includes(this.trackingGroup):"us"===this.getLocation()},e.prototype.consentsUpdated=function(){if(this.oneTrustCookieExists()){var e=this.getLocation(),t="us"===e?!this.readTrackingConsents():this.readTrackingConsents();e&&this.resolveConsent({gdprConsent:!Ft.includes(e)||t,geoRequiresConsent:Ft.includes(e),geoRequiresSignal:"us"===e,ccpaSignal:"us"===e&&t})}},e=Wt([ee(),Bt(0,X("Cookies")),Bt(1,X("window")),Ht("design:paramtypes",["function"==typeof(t="undefined"!=typeof CookiesManager&&CookiesManager)?t:Object,"function"==typeof(n="undefined"!=typeof Window&&Window)?n:Object])],e)}(),Qt={};r(Qt,"TcfApi",(()=>Qn),(e=>Qn=e)),(_t=Ot||(Ot={})).PING="ping",_t.GET_TC_DATA="getTCData",_t.GET_IN_APP_TC_DATA="getInAppTCData",_t.GET_VENDOR_LIST="getVendorList",_t.ADD_EVENT_LISTENER="addEventListener",_t.REMOVE_EVENT_LISTENER="removeEventListener",(kt=Et||(Et={})).STUB="stub",kt.LOADING="loading",kt.LOADED="loaded",kt.ERROR="error",(Pt=Tt||(Tt={})).VISIBLE="visible",Pt.HIDDEN="hidden",Pt.DISABLED="disabled",(At=Lt||(Lt={})).TC_LOADED="tcloaded",At.CMP_UI_SHOWN="cmpuishown",At.USER_ACTION_COMPLETE="useractioncomplete";class zt{listenerId;callback;next;param;success=!0;constructor(e,t,n,r){Object.assign(this,{callback:e,listenerId:n,param:t,next:r});try{this.respond()}catch(e){this.invokeCallback(null)}}invokeCallback(e){const t=null!==e;"function"==typeof this.next?this.callback(this.next,e,t):this.callback(e,t)}}class $t extends zt{respond(){this.throwIfParamInvalid(),this.invokeCallback(new Zt(this.param,this.listenerId))}throwIfParamInvalid(){if(!(void 0===this.param||Array.isArray(this.param)&&this.param.every(Number.isInteger)))throw new Error("Invalid Parameter")}}class Yt{eventQueue=new Map;queueNumber=0;add(e){return this.eventQueue.set(this.queueNumber,e),this.queueNumber++}remove(e){return this.eventQueue.delete(e)}exec(){this.eventQueue.forEach(((e,t)=>{new $t(e.callback,e.param,t,e.next)}))}clear(){this.queueNumber=0,this.eventQueue.clear()}get size(){return this.eventQueue.size}}class Kt{static apiVersion="2";static tcfPolicyVersion;static eventQueue=new Yt;static cmpStatus=Et.LOADING;static disabled=!1;static displayStatus=Tt.HIDDEN;static cmpId;static cmpVersion;static eventStatus;static gdprApplies;static tcModel;static tcString;static reset(){delete this.cmpId,delete this.cmpVersion,delete this.eventStatus,delete this.gdprApplies,delete this.tcModel,delete this.tcString,delete this.tcfPolicyVersion,this.cmpStatus=Et.LOADING,this.disabled=!1,this.displayStatus=Tt.HIDDEN,this.eventQueue.clear()}}class Jt{cmpId=Kt.cmpId;cmpVersion=Kt.cmpVersion;gdprApplies=Kt.gdprApplies;tcfPolicyVersion=Kt.tcfPolicyVersion}class Xt extends Jt{cmpStatus=Et.ERROR}class Zt extends Jt{tcString;listenerId;eventStatus;cmpStatus;isServiceSpecific;useNonStandardStacks;publisherCC;purposeOneTreatment;outOfBand;purpose;vendor;specialFeatureOptins;publisher;constructor(e,t){if(super(),this.eventStatus=Kt.eventStatus,this.cmpStatus=Kt.cmpStatus,this.listenerId=t,Kt.gdprApplies){const t=Kt.tcModel;this.tcString=Kt.tcString,this.isServiceSpecific=t.isServiceSpecific,this.useNonStandardStacks=t.useNonStandardStacks,this.purposeOneTreatment=t.purposeOneTreatment,this.publisherCC=t.publisherCountryCode,this.outOfBand={allowedVendors:this.createVectorField(t.vendorsAllowed,e),disclosedVendors:this.createVectorField(t.vendorsDisclosed,e)},this.purpose={consents:this.createVectorField(t.purposeConsents),legitimateInterests:this.createVectorField(t.purposeLegitimateInterests)},this.vendor={consents:this.createVectorField(t.vendorConsents,e),legitimateInterests:this.createVectorField(t.vendorLegitimateInterests,e)},this.specialFeatureOptins=this.createVectorField(t.specialFeatureOptins),this.publisher={consents:this.createVectorField(t.publisherConsents),legitimateInterests:this.createVectorField(t.publisherLegitimateInterests),customPurpose:{consents:this.createVectorField(t.publisherCustomConsents),legitimateInterests:this.createVectorField(t.publisherCustomLegitimateInterests)},restrictions:this.createRestrictions(t.publisherRestrictions)}}}createRestrictions(e){const t={};if(e.numRestrictions>0){const n=e.getMaxVendorId();for(let r=1;r<=n;r++){const n=r.toString();e.getRestrictions(r).forEach((e=>{const r=e.purposeId.toString();t[r]||(t[r]={}),t[r][n]=e.restrictionType}))}}return t}createVectorField(e,t){return t?t.reduce(((t,n)=>(t[String(n)]=e.has(Number(n)),t)),{}):[...e].reduce(((e,t)=>(e[t[0].toString(10)]=t[1],e)),{})}}class en extends Zt{constructor(e){super(e),delete this.outOfBand}createVectorField(e){return[...e].reduce(((e,t)=>e+=t[1]?"1":"0"),"")}createRestrictions(e){const t={};if(e.numRestrictions>0){const n=e.getMaxVendorId();e.getRestrictions().forEach((e=>{t[e.purposeId.toString()]="_".repeat(n)}));for(let r=0;r<n;r++){const n=r+1;e.getRestrictions(n).forEach((e=>{const n=e.restrictionType.toString(),o=e.purposeId.toString(),i=t[o].substr(0,r),s=t[o].substr(r+1);t[o]=i+n+s}))}}return t}}class tn extends Jt{cmpLoaded=!0;cmpStatus=Kt.cmpStatus;displayStatus=Kt.displayStatus;apiVersion=String(Kt.apiVersion);gvlVersion;constructor(){super(),Kt.tcModel&&Kt.tcModel.vendorListVersion&&(this.gvlVersion=+Kt.tcModel.vendorListVersion)}}class nn extends zt{respond(){this.invokeCallback(new tn)}}class rn extends $t{respond(){this.throwIfParamInvalid(),this.invokeCallback(new en(this.param))}}class on extends Error{constructor(e){super(e),this.name="DecodingError"}}class sn extends Error{constructor(e){super(e),this.name="EncodingError"}}class an extends Error{constructor(e){super(e),this.name="GVLError"}}class cn extends Error{constructor(e,t,n=""){super(`invalid value ${t} passed for ${e} ${n}`),this.name="TCModelError"}}class un{static DICT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";static REVERSE_DICT=new Map([["A",0],["B",1],["C",2],["D",3],["E",4],["F",5],["G",6],["H",7],["I",8],["J",9],["K",10],["L",11],["M",12],["N",13],["O",14],["P",15],["Q",16],["R",17],["S",18],["T",19],["U",20],["V",21],["W",22],["X",23],["Y",24],["Z",25],["a",26],["b",27],["c",28],["d",29],["e",30],["f",31],["g",32],["h",33],["i",34],["j",35],["k",36],["l",37],["m",38],["n",39],["o",40],["p",41],["q",42],["r",43],["s",44],["t",45],["u",46],["v",47],["w",48],["x",49],["y",50],["z",51],["0",52],["1",53],["2",54],["3",55],["4",56],["5",57],["6",58],["7",59],["8",60],["9",61],["-",62],["_",63]]);static BASIS=6;static LCM=24;static encode(e){if(!/^[0-1]+$/.test(e))throw new sn("Invalid bitField");const t=e.length%this.LCM;e+=t?"0".repeat(this.LCM-t):"";let n="";for(let t=0;t<e.length;t+=this.BASIS)n+=this.DICT[parseInt(e.substr(t,this.BASIS),2)];return n}static decode(e){if(!/^[A-Za-z0-9\-_]+$/.test(e))throw new on("Invalidly encoded Base64URL string");let t="";for(let n=0;n<e.length;n++){const r=this.REVERSE_DICT.get(e[n]).toString(2);t+="0".repeat(this.BASIS-r.length)+r}return t}}class ln{clone(){const e=new this.constructor;return Object.keys(this).forEach((t=>{const n=this.deepClone(this[t]);void 0!==n&&(e[t]=n)})),e}deepClone(e){const t=typeof e;if("number"===t||"string"===t||"boolean"===t)return e;if(null!==e&&"object"===t){if("function"==typeof e.clone)return e.clone();if(e instanceof Date)return new Date(e.getTime());if(void 0!==e[Symbol.iterator]){const t=[];for(const n of e)t.push(this.deepClone(n));return e instanceof Array?t:new e.constructor(t)}{const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=this.deepClone(e[n]));return t}}}}class pn extends ln{root=null;isEmpty(){return!this.root}add(e){const t={value:e,left:null,right:null};let n;if(this.isEmpty())this.root=t;else for(n=this.root;;)if(e<n.value){if(null===n.left){n.left=t;break}n=n.left}else{if(!(e>n.value))break;if(null===n.right){n.right=t;break}n=n.right}}get(){const e=[];let t=this.root;for(;t;)if(t.left){let n=t.left;for(;n.right&&n.right!=t;)n=n.right;n.right==t?(n.right=null,e.push(t.value),t=t.right):(n.right=t,t=t.left)}else e.push(t.value),t=t.right;return e}contains(e){let t=!1,n=this.root;for(;n;){if(n.value===e){t=!0;break}e>n.value?n=n.right:e<n.value&&(n=n.left)}return t}min(e=this.root){let t;for(;e;)e.left?e=e.left:(t=e.value,e=null);return t}max(e=this.root){let t;for(;e;)e.right?e=e.right:(t=e.value,e=null);return t}remove(e,t=this.root){let n=null,r="left";for(;t;)if(e<t.value)n=t,t=t.left,r="left";else if(e>t.value)n=t,t=t.right,r="right";else{if(t.left||t.right)if(t.left)if(t.right){const e=this.min(t.right);this.remove(e,t.right),t.value=e}else n?n[r]=t.left:this.root=t.left;else n?n[r]=t.right:this.root=t.right;else n?n[r]=null:this.root=null;t=null}}}class fn{static langSet=new Set(["BG","CA","CS","DA","DE","EL","EN","ES","ET","FI","FR","HR","HU","IT","JA","LT","LV","MT","NL","NO","PL","PT","RO","RU","SK","SL","SV","TR","ZH"]);has(e){return fn.langSet.has(e)}forEach(e){fn.langSet.forEach(e)}get size(){return fn.langSet.size}}class dn{static cmpId="cmpId";static cmpVersion="cmpVersion";static consentLanguage="consentLanguage";static consentScreen="consentScreen";static created="created";static supportOOB="supportOOB";static isServiceSpecific="isServiceSpecific";static lastUpdated="lastUpdated";static numCustomPurposes="numCustomPurposes";static policyVersion="policyVersion";static publisherCountryCode="publisherCountryCode";static publisherCustomConsents="publisherCustomConsents";static publisherCustomLegitimateInterests="publisherCustomLegitimateInterests";static publisherLegitimateInterests="publisherLegitimateInterests";static publisherConsents="publisherConsents";static publisherRestrictions="publisherRestrictions";static purposeConsents="purposeConsents";static purposeLegitimateInterests="purposeLegitimateInterests";static purposeOneTreatment="purposeOneTreatment";static specialFeatureOptins="specialFeatureOptins";static useNonStandardStacks="useNonStandardStacks";static vendorConsents="vendorConsents";static vendorLegitimateInterests="vendorLegitimateInterests";static vendorListVersion="vendorListVersion";static vendorsAllowed="vendorsAllowed";static vendorsDisclosed="vendorsDisclosed";static version="version"}(xt=jt||(jt={}))[xt.NOT_ALLOWED=0]="NOT_ALLOWED",xt[xt.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",xt[xt.REQUIRE_LI=2]="REQUIRE_LI";class hn extends ln{static hashSeparator="-";purposeId_;restrictionType;constructor(e,t){super(),void 0!==e&&(this.purposeId=e),void 0!==t&&(this.restrictionType=t)}static unHash(e){const t=e.split(this.hashSeparator),n=new hn;if(2!==t.length)throw new cn("hash",e);return n.purposeId=parseInt(t[0],10),n.restrictionType=parseInt(t[1],10),n}get hash(){if(!this.isValid())throw new Error("cannot hash invalid PurposeRestriction");return`${this.purposeId}${hn.hashSeparator}${this.restrictionType}`}get purposeId(){return this.purposeId_}set purposeId(e){this.purposeId_=e}isValid(){return Number.isInteger(this.purposeId)&&this.purposeId>0&&(this.restrictionType===jt.NOT_ALLOWED||this.restrictionType===jt.REQUIRE_CONSENT||this.restrictionType===jt.REQUIRE_LI)}isSameAs(e){return this.purposeId===e.purposeId&&this.restrictionType===e.restrictionType}}class gn extends ln{bitLength=0;map=new Map;gvl_;has(e){return this.map.has(e)}isOkToHave(e,t,n){let r=!0;if(this.gvl?.vendors){const o=this.gvl.vendors[n];if(o)if(e===jt.NOT_ALLOWED)r=o.legIntPurposes.includes(t)||o.purposes.includes(t);else if(o.flexiblePurposes.length)switch(e){case jt.REQUIRE_CONSENT:r=o.flexiblePurposes.includes(t)&&o.legIntPurposes.includes(t);break;case jt.REQUIRE_LI:r=o.flexiblePurposes.includes(t)&&o.purposes.includes(t)}else r=!1;else r=!1}return r}add(e,t){if(this.isOkToHave(t.restrictionType,t.purposeId,e)){const n=t.hash;this.has(n)||(this.map.set(n,new pn),this.bitLength=0),this.map.get(n).add(e)}}restrictPurposeToLegalBasis(e){const t=this.gvl.vendorIds,n=e.hash,r=function(){let e;for(e of t);return e}();for(let e=1;e<=r;e++)this.has(n)||(this.map.set(n,new pn),this.bitLength=0),this.map.get(n).add(e)}getVendors(e){let t=[];if(e){const n=e.hash;this.has(n)&&(t=this.map.get(n).get())}else{const e=new Set;this.map.forEach((t=>{t.get().forEach((t=>{e.add(t)}))})),t=Array.from(e)}return t}getRestrictionType(e,t){let n;return this.getRestrictions(e).forEach((e=>{e.purposeId===t&&(void 0===n||n>e.restrictionType)&&(n=e.restrictionType)})),n}vendorHasRestriction(e,t){let n=!1;const r=this.getRestrictions(e);for(let e=0;e<r.length&&!n;e++)n=t.isSameAs(r[e]);return n}getMaxVendorId(){let e=0;return this.map.forEach((t=>{e=Math.max(t.max(),e)})),e}getRestrictions(e){const t=[];return this.map.forEach(((n,r)=>{e?n.contains(e)&&t.push(hn.unHash(r)):t.push(hn.unHash(r))})),t}getPurposes(){const e=new Set;return this.map.forEach(((t,n)=>{e.add(hn.unHash(n).purposeId)})),Array.from(e)}remove(e,t){const n=t.hash,r=this.map.get(n);r&&(r.remove(e),r.isEmpty()&&(this.map.delete(n),this.bitLength=0))}set gvl(e){this.gvl_||(this.gvl_=e,this.map.forEach(((e,t)=>{const n=hn.unHash(t);e.get().forEach((t=>{this.isOkToHave(n.restrictionType,n.purposeId,t)||e.remove(t)}))})))}get gvl(){return this.gvl_}isEmpty(){return 0===this.map.size}get numRestrictions(){return this.map.size}}(Vt=Dt||(Dt={})).COOKIE="cookie",Vt.WEB="web",Vt.APP="app",(Mt=Nt||(Nt={})).CORE="core",Mt.VENDORS_DISCLOSED="vendorsDisclosed",Mt.VENDORS_ALLOWED="vendorsAllowed",Mt.PUBLISHER_TC="publisherTC";class vn{static ID_TO_KEY=[Nt.CORE,Nt.VENDORS_DISCLOSED,Nt.VENDORS_ALLOWED,Nt.PUBLISHER_TC];static KEY_TO_ID={[Nt.CORE]:0,[Nt.VENDORS_DISCLOSED]:1,[Nt.VENDORS_ALLOWED]:2,[Nt.PUBLISHER_TC]:3}}class yn extends ln{bitLength=0;maxId_=0;set_=new Set;*[Symbol.iterator](){for(let e=1;e<=this.maxId;e++)yield[e,this.has(e)]}values(){return this.set_.values()}get maxId(){return this.maxId_}has(e){return this.set_.has(e)}unset(e){Array.isArray(e)?e.forEach((e=>this.unset(e))):"object"==typeof e?this.unset(Object.keys(e).map((e=>Number(e)))):(this.set_.delete(Number(e)),this.bitLength=0,e===this.maxId&&(this.maxId_=0,this.set_.forEach((e=>{this.maxId_=Math.max(this.maxId,e)}))))}isIntMap(e){let t="object"==typeof e;return t=t&&Object.keys(e).every((t=>{let n=Number.isInteger(parseInt(t,10));return n=n&&this.isValidNumber(e[t].id),n=n&&void 0!==e[t].name,n})),t}isValidNumber(e){return parseInt(e,10)>0}isSet(e){let t=!1;return e instanceof Set&&(t=Array.from(e).every(this.isValidNumber)),t}set(e){if(Array.isArray(e))e.forEach((e=>this.set(e)));else if(this.isSet(e))this.set(Array.from(e));else if(this.isIntMap(e))this.set(Object.keys(e).map((e=>Number(e))));else{if(!this.isValidNumber(e))throw new cn("set()",e,"must be positive integer array, positive integer, Set<number>, or IntMap");this.set_.add(e),this.maxId_=Math.max(this.maxId,e),this.bitLength=0}}empty(){this.set_=new Set}forEach(e){for(let t=1;t<=this.maxId;t++)e(this.has(t),t)}get size(){return this.set_.size}setAll(e){this.set(e)}}class mn{static[dn.cmpId]=12;static[dn.cmpVersion]=12;static[dn.consentLanguage]=12;static[dn.consentScreen]=6;static[dn.created]=36;static[dn.isServiceSpecific]=1;static[dn.lastUpdated]=36;static[dn.policyVersion]=6;static[dn.publisherCountryCode]=12;static[dn.publisherLegitimateInterests]=24;static[dn.publisherConsents]=24;static[dn.purposeConsents]=24;static[dn.purposeLegitimateInterests]=24;static[dn.purposeOneTreatment]=1;static[dn.specialFeatureOptins]=12;static[dn.useNonStandardStacks]=1;static[dn.vendorListVersion]=12;static[dn.version]=6;static anyBoolean=1;static encodingType=1;static maxId=16;static numCustomPurposes=6;static numEntries=12;static numRestrictions=12;static purposeId=6;static restrictionType=2;static segmentType=3;static singleOrRange=1;static vendorId=16}class bn{static encode(e){return String(Number(e))}static decode(e){return"1"===e}}class wn{static encode(e,t){let n;if("string"==typeof e&&(e=parseInt(e,10)),n=e.toString(2),n.length>t||e<0)throw new sn(`${e} too large to encode into ${t}`);return n.length<t&&(n="0".repeat(t-n.length)+n),n}static decode(e,t){if(t!==e.length)throw new on("invalid bit length");return parseInt(e,2)}}class Sn{static encode(e,t){return wn.encode(Math.round(e.getTime()/100),t)}static decode(e,t){if(t!==e.length)throw new on("invalid bit length");const n=new Date;return n.setTime(100*wn.decode(e,t)),n}}class Cn{static encode(e,t){let n="";for(let r=1;r<=t;r++)n+=bn.encode(e.has(r));return n}static decode(e,t){if(e.length!==t)throw new on("bitfield encoding length mismatch");const n=new yn;for(let r=1;r<=t;r++)bn.decode(e[r-1])&&n.set(r);return n.bitLength=e.length,n}}class In{static encode(e,t){const n=(e=e.toUpperCase()).charCodeAt(0)-65,r=e.charCodeAt(1)-65;if(n<0||n>25||r<0||r>25)throw new sn(`invalid language code: ${e}`);if(t%2==1)throw new sn(`numBits must be even, ${t} is not valid`);t/=2;return wn.encode(n,t)+wn.encode(r,t)}static decode(e,t){let n;if(t!==e.length||e.length%2)throw new on("invalid bit length for language");{const t=65,r=e.length/2,o=wn.decode(e.slice(0,r),r)+t,i=wn.decode(e.slice(r),r)+t;n=String.fromCharCode(o)+String.fromCharCode(i)}return n}}class Rn{static encode(e){let t=wn.encode(e.numRestrictions,mn.numRestrictions);return e.isEmpty()||e.getRestrictions().forEach((n=>{t+=wn.encode(n.purposeId,mn.purposeId),t+=wn.encode(n.restrictionType,mn.restrictionType);const r=e.getVendors(n),o=r.length;let i=0,s=0,a="";for(let t=0;t<o;t++){const n=r[t];0===s&&(i++,s=n);const c=r[o-1],u=e.gvl.vendorIds,l=e=>{for(;++e<=c&&!u.has(e););return e};if(t===o-1||r[t+1]>l(n)){const e=!(n===s);a+=bn.encode(e),a+=wn.encode(s,mn.vendorId),e&&(a+=wn.encode(n,mn.vendorId)),s=0}}t+=wn.encode(i,mn.numEntries),t+=a})),t}static decode(e){let t=0;const n=new gn,r=wn.decode(e.substr(t,mn.numRestrictions),mn.numRestrictions);t+=mn.numRestrictions;for(let o=0;o<r;o++){const r=wn.decode(e.substr(t,mn.purposeId),mn.purposeId);t+=mn.purposeId;const o=wn.decode(e.substr(t,mn.restrictionType),mn.restrictionType);t+=mn.restrictionType;const i=new hn(r,o),s=wn.decode(e.substr(t,mn.numEntries),mn.numEntries);t+=mn.numEntries;for(let r=0;r<s;r++){const r=bn.decode(e.substr(t,mn.anyBoolean));t+=mn.anyBoolean;const o=wn.decode(e.substr(t,mn.vendorId),mn.vendorId);if(t+=mn.vendorId,r){const r=wn.decode(e.substr(t,mn.vendorId),mn.vendorId);if(t+=mn.vendorId,r<o)throw new on(`Invalid RangeEntry: endVendorId ${r} is less than ${o}`);for(let e=o;e<=r;e++)n.add(e,i)}else n.add(o,i)}}return n.bitLength=t,n}}(Gt=Ut||(Ut={}))[Gt.FIELD=0]="FIELD",Gt[Gt.RANGE=1]="RANGE";class On{static encode(e){const t=[];let n,r=[],o=wn.encode(e.maxId,mn.maxId),i="";const s=mn.maxId+mn.encodingType,a=s+e.maxId,c=2*mn.vendorId+mn.singleOrRange+mn.numEntries;let u=s+mn.numEntries;return e.forEach(((o,s)=>{if(i+=bn.encode(o),n=e.maxId>c&&u<a,n&&o){e.has(s+1)?0===r.length&&(r.push(s),u+=mn.singleOrRange,u+=mn.vendorId):(r.push(s),u+=mn.vendorId,t.push(r),r=[])}})),n?(o+=String(Ut.RANGE),o+=this.buildRangeEncoding(t)):(o+=String(Ut.FIELD),o+=i),o}static decode(e,t){let n,r=0;const o=wn.decode(e.substr(r,mn.maxId),mn.maxId);r+=mn.maxId;const i=wn.decode(e.charAt(r),mn.encodingType);if(r+=mn.encodingType,i===Ut.RANGE){if(n=new yn,1===t){if("1"===e.substr(r,1))throw new on("Unable to decode default consent=1");r++}const o=wn.decode(e.substr(r,mn.numEntries),mn.numEntries);r+=mn.numEntries;for(let t=0;t<o;t++){const t=bn.decode(e.charAt(r));r+=mn.singleOrRange;const o=wn.decode(e.substr(r,mn.vendorId),mn.vendorId);if(r+=mn.vendorId,t){const t=wn.decode(e.substr(r,mn.vendorId),mn.vendorId);r+=mn.vendorId;for(let e=o;e<=t;e++)n.set(e)}else n.set(o)}}else{const t=e.substr(r,o);r+=o,n=Cn.decode(t,o)}return n.bitLength=r,n}static buildRangeEncoding(e){const t=e.length;let n=wn.encode(t,mn.numEntries);return e.forEach((e=>{const t=1===e.length;n+=bn.encode(!t),n+=wn.encode(e[0],mn.vendorId),t||(n+=wn.encode(e[1],mn.vendorId))})),n}}function _n(){return{[dn.version]:wn,[dn.created]:Sn,[dn.lastUpdated]:Sn,[dn.cmpId]:wn,[dn.cmpVersion]:wn,[dn.consentScreen]:wn,[dn.consentLanguage]:In,[dn.vendorListVersion]:wn,[dn.policyVersion]:wn,[dn.isServiceSpecific]:bn,[dn.useNonStandardStacks]:bn,[dn.specialFeatureOptins]:Cn,[dn.purposeConsents]:Cn,[dn.purposeLegitimateInterests]:Cn,[dn.purposeOneTreatment]:bn,[dn.publisherCountryCode]:In,[dn.vendorConsents]:On,[dn.vendorLegitimateInterests]:On,[dn.publisherRestrictions]:Rn,segmentType:wn,[dn.vendorsDisclosed]:On,[dn.vendorsAllowed]:On,[dn.publisherConsents]:Cn,[dn.publisherLegitimateInterests]:Cn,[dn.numCustomPurposes]:wn,[dn.publisherCustomConsents]:Cn,[dn.publisherCustomLegitimateInterests]:Cn}}class En{1={[Nt.CORE]:[dn.version,dn.created,dn.lastUpdated,dn.cmpId,dn.cmpVersion,dn.consentScreen,dn.consentLanguage,dn.vendorListVersion,dn.purposeConsents,dn.vendorConsents]};2={[Nt.CORE]:[dn.version,dn.created,dn.lastUpdated,dn.cmpId,dn.cmpVersion,dn.consentScreen,dn.consentLanguage,dn.vendorListVersion,dn.policyVersion,dn.isServiceSpecific,dn.useNonStandardStacks,dn.specialFeatureOptins,dn.purposeConsents,dn.purposeLegitimateInterests,dn.purposeOneTreatment,dn.publisherCountryCode,dn.vendorConsents,dn.vendorLegitimateInterests,dn.publisherRestrictions],[Nt.PUBLISHER_TC]:[dn.publisherConsents,dn.publisherLegitimateInterests,dn.numCustomPurposes,dn.publisherCustomConsents,dn.publisherCustomLegitimateInterests],[Nt.VENDORS_ALLOWED]:[dn.vendorsAllowed],[Nt.VENDORS_DISCLOSED]:[dn.vendorsDisclosed]}}class kn{1=[Nt.CORE];2=[Nt.CORE];constructor(e,t){if(2===e.version)if(e.isServiceSpecific)this[2].push(Nt.PUBLISHER_TC);else{const n=!(!t||!t.isForVendors);n&&!0!==e[dn.supportOOB]||this[2].push(Nt.VENDORS_DISCLOSED),n&&(e[dn.supportOOB]&&e[dn.vendorsAllowed].size>0&&this[2].push(Nt.VENDORS_ALLOWED),this[2].push(Nt.PUBLISHER_TC))}}}class Tn{static fieldSequence=new En;static encode(e,t){let n;try{n=this.fieldSequence[String(e.version)][t]}catch(n){throw new sn(`Unable to encode version: ${e.version}, segment: ${t}`)}let r="";t!==Nt.CORE&&(r=wn.encode(vn.KEY_TO_ID[t],mn.segmentType));const o=_n();return n.forEach((n=>{const i=e[n],s=o[n];let a=mn[n];void 0===a&&this.isPublisherCustom(n)&&(a=Number(e[dn.numCustomPurposes]));try{r+=s.encode(i,a)}catch(e){throw new sn(`Error encoding ${t}->${n}: ${e.message}`)}})),un.encode(r)}static decode(e,t,n){const r=un.decode(e);let o=0;n===Nt.CORE&&(t.version=wn.decode(r.substr(o,mn[dn.version]),mn[dn.version])),n!==Nt.CORE&&(o+=mn.segmentType);const i=this.fieldSequence[String(t.version)][n],s=_n();return i.forEach((e=>{const n=s[e];let i=mn[e];if(void 0===i&&this.isPublisherCustom(e)&&(i=Number(t[dn.numCustomPurposes])),0!==i){const s=r.substr(o,i);if(t[e]=n===On?n.decode(s,t.version):n.decode(s,i),Number.isInteger(i))o+=i;else{if(!Number.isInteger(t[e].bitLength))throw new on(e);o+=t[e].bitLength}}})),t}static isPublisherCustom(e){return 0===e.indexOf("publisherCustom")}}class Pn{static processor=[e=>e,(e,t)=>{e.publisherRestrictions.gvl=t,e.purposeLegitimateInterests.unset(1);const n=new Map;return n.set("legIntPurposes",e.vendorLegitimateInterests),n.set("purposes",e.vendorConsents),n.forEach(((n,r)=>{n.forEach(((o,i)=>{if(o){const o=t.vendors[i];if(!o||o.deletedDate)n.unset(i);else if(0===o[r].length)if("legIntPurposes"===r&&0===o.purposes.length&&0===o.legIntPurposes.length&&o.specialPurposes.length>0);else if(e.isServiceSpecific)if(0===o.flexiblePurposes.length)n.unset(i);else{const t=e.publisherRestrictions.getRestrictions(i);let o=!1;for(let e=0,n=t.length;e<n&&!o;e++)o=t[e].restrictionType===jt.REQUIRE_CONSENT&&"purposes"===r||t[e].restrictionType===jt.REQUIRE_LI&&"legIntPurposes"===r;o||n.unset(i)}else n.unset(i)}}))})),e.vendorsDisclosed.set(t.vendors),e}];static process(e,t){const n=e.gvl;if(!n)throw new sn("Unable to encode TCModel without a GVL");if(!n.isReady)throw new sn("Unable to encode TCModel tcModel.gvl.readyPromise is not resolved");(e=e.clone()).consentLanguage=n.language.toUpperCase(),t?.version>0&&t?.version<=this.processor.length?e.version=t.version:e.version=this.processor.length;const r=e.version-1;if(!this.processor[r])throw new sn(`Invalid version: ${e.version}`);return this.processor[r](e,n)}}class Ln{static absCall(e,t,n,r){return new Promise(((o,i)=>{const s=new XMLHttpRequest;s.withCredentials=n,s.addEventListener("load",(()=>{if(s.readyState==XMLHttpRequest.DONE)if(s.status>=200&&s.status<300){let e=s.response;if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}o(e)}else i(new Error(`HTTP Status: ${s.status} response type: ${s.responseType}`))})),s.addEventListener("error",(()=>{i(new Error("error"))})),s.addEventListener("abort",(()=>{i(new Error("aborted"))})),null===t?s.open("GET",e,!0):s.open("POST",e,!0),s.responseType="json",s.timeout=r,s.ontimeout=()=>{i(new Error("Timeout "+r+"ms "+e))},s.send(t)}))}static post(e,t,n=!1,r=0){return this.absCall(e,JSON.stringify(t),n,r)}static fetch(e,t=!1,n=0){return this.absCall(e,null,t,n)}}class An extends ln{static LANGUAGE_CACHE=new Map;static CACHE=new Map;static LATEST_CACHE_KEY=0;static DEFAULT_LANGUAGE="EN";static consentLanguages=new fn;static baseUrl_;static set baseUrl(e){if(/^https?:\/\/vendorlist\.consensu\.org\//.test(e))throw new an("Invalid baseUrl!  You may not pull directly from vendorlist.consensu.org and must provide your own cache");e.length>0&&"/"!==e[e.length-1]&&(e+="/"),this.baseUrl_=e}static get baseUrl(){return this.baseUrl_}static latestFilename="vendor-list.json";static versionedFilename="archives/vendor-list-v[VERSION].json";static languageFilename="purposes-[LANG].json";readyPromise;gvlSpecificationVersion;vendorListVersion;tcfPolicyVersion;lastUpdated;purposes;specialPurposes;features;specialFeatures;isReady_=!1;vendors_;vendorIds;fullVendorList;byPurposeVendorMap;bySpecialPurposeVendorMap;byFeatureVendorMap;bySpecialFeatureVendorMap;stacks;lang_;isLatest=!1;constructor(e){super();let t=An.baseUrl;if(this.lang_=An.DEFAULT_LANGUAGE,this.isVendorList(e))this.populate(e),this.readyPromise=Promise.resolve();else{if(!t)throw new an("must specify GVL.baseUrl before loading GVL json");if(e>0){const n=e;An.CACHE.has(n)?(this.populate(An.CACHE.get(n)),this.readyPromise=Promise.resolve()):(t+=An.versionedFilename.replace("[VERSION]",String(n)),this.readyPromise=this.fetchJson(t))}else An.CACHE.has(An.LATEST_CACHE_KEY)?(this.populate(An.CACHE.get(An.LATEST_CACHE_KEY)),this.readyPromise=Promise.resolve()):(this.isLatest=!0,this.readyPromise=this.fetchJson(t+An.latestFilename))}}static emptyLanguageCache(e){let t=!1;return void 0===e&&An.LANGUAGE_CACHE.size>0?(An.LANGUAGE_CACHE=new Map,t=!0):"string"==typeof e&&this.consentLanguages.has(e.toUpperCase())&&(An.LANGUAGE_CACHE.delete(e.toUpperCase()),t=!0),t}static emptyCache(e){let t=!1;return Number.isInteger(e)&&e>=0?(An.CACHE.delete(e),t=!0):void 0===e&&(An.CACHE=new Map,t=!0),t}cacheLanguage(){An.LANGUAGE_CACHE.has(this.lang_)||An.LANGUAGE_CACHE.set(this.lang_,{purposes:this.purposes,specialPurposes:this.specialPurposes,features:this.features,specialFeatures:this.specialFeatures,stacks:this.stacks})}async fetchJson(e){try{this.populate(await Ln.fetch(e))}catch(e){throw new an(e.message)}}getJson(){return JSON.parse(JSON.stringify({gvlSpecificationVersion:this.gvlSpecificationVersion,vendorListVersion:this.vendorListVersion,tcfPolicyVersion:this.tcfPolicyVersion,lastUpdated:this.lastUpdated,purposes:this.purposes,specialPurposes:this.specialPurposes,features:this.features,specialFeatures:this.specialFeatures,stacks:this.stacks,vendors:this.fullVendorList}))}async changeLanguage(e){const t=e.toUpperCase();if(!An.consentLanguages.has(t))throw new an(`unsupported language ${e}`);if(t!==this.lang_)if(this.lang_=t,An.LANGUAGE_CACHE.has(t)){const e=An.LANGUAGE_CACHE.get(t);for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}else{const t=An.baseUrl+An.languageFilename.replace("[LANG]",e);try{await this.fetchJson(t),this.cacheLanguage()}catch(e){throw new an("unable to load language: "+e.message)}}}get language(){return this.lang_}isVendorList(e){return void 0!==e&&void 0!==e.vendors}populate(e){this.purposes=e.purposes,this.specialPurposes=e.specialPurposes,this.features=e.features,this.specialFeatures=e.specialFeatures,this.stacks=e.stacks,this.isVendorList(e)&&(this.gvlSpecificationVersion=e.gvlSpecificationVersion,this.tcfPolicyVersion=e.tcfPolicyVersion,this.vendorListVersion=e.vendorListVersion,this.lastUpdated=e.lastUpdated,"string"==typeof this.lastUpdated&&(this.lastUpdated=new Date(this.lastUpdated)),this.vendors_=e.vendors,this.fullVendorList=e.vendors,this.mapVendors(),this.isReady_=!0,this.isLatest&&An.CACHE.set(An.LATEST_CACHE_KEY,this.getJson()),An.CACHE.has(this.vendorListVersion)||An.CACHE.set(this.vendorListVersion,this.getJson())),this.cacheLanguage()}mapVendors(e){this.byPurposeVendorMap={},this.bySpecialPurposeVendorMap={},this.byFeatureVendorMap={},this.bySpecialFeatureVendorMap={},Object.keys(this.purposes).forEach((e=>{this.byPurposeVendorMap[e]={legInt:new Set,consent:new Set,flexible:new Set}})),Object.keys(this.specialPurposes).forEach((e=>{this.bySpecialPurposeVendorMap[e]=new Set})),Object.keys(this.features).forEach((e=>{this.byFeatureVendorMap[e]=new Set})),Object.keys(this.specialFeatures).forEach((e=>{this.bySpecialFeatureVendorMap[e]=new Set})),Array.isArray(e)||(e=Object.keys(this.fullVendorList).map((e=>+e))),this.vendorIds=new Set(e),this.vendors_=e.reduce(((e,t)=>{const n=this.vendors_[String(t)];return n&&void 0===n.deletedDate&&(n.purposes.forEach((e=>{this.byPurposeVendorMap[String(e)].consent.add(t)})),n.specialPurposes.forEach((e=>{this.bySpecialPurposeVendorMap[String(e)].add(t)})),n.legIntPurposes.forEach((e=>{this.byPurposeVendorMap[String(e)].legInt.add(t)})),n.flexiblePurposes&&n.flexiblePurposes.forEach((e=>{this.byPurposeVendorMap[String(e)].flexible.add(t)})),n.features.forEach((e=>{this.byFeatureVendorMap[String(e)].add(t)})),n.specialFeatures.forEach((e=>{this.bySpecialFeatureVendorMap[String(e)].add(t)})),e[t]=n),e}),{})}getFilteredVendors(e,t,n,r){const o=e.charAt(0).toUpperCase()+e.slice(1);let i;const s={};return i="purpose"===e&&n?this["by"+o+"VendorMap"][String(t)][n]:this["by"+(r?"Special":"")+o+"VendorMap"][String(t)],i.forEach((e=>{s[String(e)]=this.vendors[String(e)]})),s}getVendorsWithConsentPurpose(e){return this.getFilteredVendors("purpose",e,"consent")}getVendorsWithLegIntPurpose(e){return this.getFilteredVendors("purpose",e,"legInt")}getVendorsWithFlexiblePurpose(e){return this.getFilteredVendors("purpose",e,"flexible")}getVendorsWithSpecialPurpose(e){return this.getFilteredVendors("purpose",e,void 0,!0)}getVendorsWithFeature(e){return this.getFilteredVendors("feature",e)}getVendorsWithSpecialFeature(e){return this.getFilteredVendors("feature",e,void 0,!0)}get vendors(){return this.vendors_}narrowVendorsTo(e){this.mapVendors(e)}get isReady(){return this.isReady_}clone(){const e=new An(this.getJson());return this.lang_!==An.DEFAULT_LANGUAGE&&e.changeLanguage(this.lang_),e}static isInstanceOf(e){return"object"==typeof e&&"function"==typeof e.narrowVendorsTo}}class jn extends ln{static consentLanguages=An.consentLanguages;isServiceSpecific_=!1;supportOOB_=!0;useNonStandardStacks_=!1;purposeOneTreatment_=!1;publisherCountryCode_="AA";version_=2;consentScreen_=0;policyVersion_=2;consentLanguage_="EN";cmpId_=0;cmpVersion_=0;vendorListVersion_=0;numCustomPurposes_=0;gvl_;created;lastUpdated;specialFeatureOptins=new yn;purposeConsents=new yn;purposeLegitimateInterests=new yn;publisherConsents=new yn;publisherLegitimateInterests=new yn;publisherCustomConsents=new yn;publisherCustomLegitimateInterests=new yn;customPurposes;vendorConsents=new yn;vendorLegitimateInterests=new yn;vendorsDisclosed=new yn;vendorsAllowed=new yn;publisherRestrictions=new gn;constructor(e){super(),e&&(this.gvl=e),this.updated()}set gvl(e){An.isInstanceOf(e)||(e=new An(e)),this.gvl_=e,this.publisherRestrictions.gvl=e}get gvl(){return this.gvl_}set cmpId(e){if(e=Number(e),!(Number.isInteger(e)&&e>1))throw new cn("cmpId",e);this.cmpId_=e}get cmpId(){return this.cmpId_}set cmpVersion(e){if(e=Number(e),!(Number.isInteger(e)&&e>-1))throw new cn("cmpVersion",e);this.cmpVersion_=e}get cmpVersion(){return this.cmpVersion_}set consentScreen(e){if(e=Number(e),!(Number.isInteger(e)&&e>-1))throw new cn("consentScreen",e);this.consentScreen_=e}get consentScreen(){return this.consentScreen_}set consentLanguage(e){this.consentLanguage_=e}get consentLanguage(){return this.consentLanguage_}set publisherCountryCode(e){if(!/^([A-z]){2}$/.test(e))throw new cn("publisherCountryCode",e);this.publisherCountryCode_=e.toUpperCase()}get publisherCountryCode(){return this.publisherCountryCode_}set vendorListVersion(e){if((e=Number(e)>>0)<0)throw new cn("vendorListVersion",e);this.vendorListVersion_=e}get vendorListVersion(){return this.gvl?this.gvl.vendorListVersion:this.vendorListVersion_}set policyVersion(e){if(this.policyVersion_=parseInt(e,10),this.policyVersion_<0)throw new cn("policyVersion",e)}get policyVersion(){return this.gvl?this.gvl.tcfPolicyVersion:this.policyVersion_}set version(e){this.version_=parseInt(e,10)}get version(){return this.version_}set isServiceSpecific(e){this.isServiceSpecific_=e}get isServiceSpecific(){return this.isServiceSpecific_}set useNonStandardStacks(e){this.useNonStandardStacks_=e}get useNonStandardStacks(){return this.useNonStandardStacks_}set supportOOB(e){this.supportOOB_=e}get supportOOB(){return this.supportOOB_}set purposeOneTreatment(e){this.purposeOneTreatment_=e}get purposeOneTreatment(){return this.purposeOneTreatment_}setAllVendorConsents(){this.vendorConsents.set(this.gvl.vendors)}unsetAllVendorConsents(){this.vendorConsents.empty()}setAllVendorsDisclosed(){this.vendorsDisclosed.set(this.gvl.vendors)}unsetAllVendorsDisclosed(){this.vendorsDisclosed.empty()}setAllVendorsAllowed(){this.vendorsAllowed.set(this.gvl.vendors)}unsetAllVendorsAllowed(){this.vendorsAllowed.empty()}setAllVendorLegitimateInterests(){this.vendorLegitimateInterests.set(this.gvl.vendors)}unsetAllVendorLegitimateInterests(){this.vendorLegitimateInterests.empty()}setAllPurposeConsents(){this.purposeConsents.set(this.gvl.purposes)}unsetAllPurposeConsents(){this.purposeConsents.empty()}setAllPurposeLegitimateInterests(){this.purposeLegitimateInterests.set(this.gvl.purposes)}unsetAllPurposeLegitimateInterests(){this.purposeLegitimateInterests.empty()}setAllSpecialFeatureOptins(){this.specialFeatureOptins.set(this.gvl.specialFeatures)}unsetAllSpecialFeatureOptins(){this.specialFeatureOptins.empty()}setAll(){this.setAllVendorConsents(),this.setAllPurposeLegitimateInterests(),this.setAllSpecialFeatureOptins(),this.setAllPurposeConsents(),this.setAllVendorLegitimateInterests()}unsetAll(){this.unsetAllVendorConsents(),this.unsetAllPurposeLegitimateInterests(),this.unsetAllSpecialFeatureOptins(),this.unsetAllPurposeConsents(),this.unsetAllVendorLegitimateInterests()}get numCustomPurposes(){let e=this.numCustomPurposes_;if("object"==typeof this.customPurposes){const t=Object.keys(this.customPurposes).sort(((e,t)=>Number(e)-Number(t)));e=parseInt(t.pop(),10)}return e}set numCustomPurposes(e){if(this.numCustomPurposes_=parseInt(e,10),this.numCustomPurposes_<0)throw new cn("numCustomPurposes",e)}updated(){const e=new Date,t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()));this.created=t,this.lastUpdated=t}}class xn{static encode(e,t){let n,r="";return e=Pn.process(e,t),n=Array.isArray(t?.segments)?t.segments:new kn(e,t)[""+e.version],n.forEach(((t,o)=>{let i="";o<n.length-1&&(i="."),r+=Tn.encode(e,t)+i})),r}static decode(e,t){const n=e.split("."),r=n.length;t||(t=new jn);for(let e=0;e<r;e++){const r=n[e],o=un.decode(r.charAt(0)).substr(0,mn.segmentType),i=vn.ID_TO_KEY[wn.decode(o,mn.segmentType).toString()];Tn.decode(r,t,i)}return t}}class Dn extends zt{respond(){const e=Kt.tcModel,t=e.vendorListVersion;let n;void 0===this.param&&(this.param=t),n=this.param===t&&e.gvl?e.gvl:new An(this.param),n.readyPromise.then((()=>{this.invokeCallback(n.getJson())}))}}class Vn extends $t{respond(){this.listenerId=Kt.eventQueue.add({callback:this.callback,param:this.param,next:this.next}),super.respond()}}class Nn extends zt{respond(){this.invokeCallback(Kt.eventQueue.remove(this.param))}}class Mn{static[Ot.PING]=nn;static[Ot.GET_TC_DATA]=$t;static[Ot.GET_IN_APP_TC_DATA]=rn;static[Ot.GET_VENDOR_LIST]=Dn;static[Ot.ADD_EVENT_LISTENER]=Vn;static[Ot.REMOVE_EVENT_LISTENER]=Nn}class Un{static set_=new Set([0,2,void 0,null]);static has(e){return"string"==typeof e&&(e=Number(e)),this.set_.has(e)}}const Gn="__tcfapi";class Fn{callQueue;customCommands;constructor(e){if(e){let t=Ot.ADD_EVENT_LISTENER;if(e?.[t])throw new Error(`Built-In Custom Commmand for ${t} not allowed: Use ${Ot.GET_TC_DATA} instead`);if(t=Ot.REMOVE_EVENT_LISTENER,e?.[t])throw new Error(`Built-In Custom Commmand for ${t} not allowed`);e?.[Ot.GET_TC_DATA]&&(e[Ot.ADD_EVENT_LISTENER]=e[Ot.GET_TC_DATA],e[Ot.REMOVE_EVENT_LISTENER]=e[Ot.GET_TC_DATA]),this.customCommands=e}try{this.callQueue=window[Gn]()||[]}catch(e){this.callQueue=[]}finally{window[Gn]=this.apiCall.bind(this),this.purgeQueuedCalls()}}apiCall(e,t,n,...r){if("string"!=typeof e)n(null,!1);else if(Un.has(t)){if("function"!=typeof n)throw new Error("invalid callback function");Kt.disabled?n(new Xt,!1):this.isCustomCommand(e)||this.isBuiltInCommand(e)?this.isCustomCommand(e)&&!this.isBuiltInCommand(e)?this.customCommands[e](n,...r):e===Ot.PING?this.isCustomCommand(e)?new Mn[e](this.customCommands[e],r[0],null,n):new Mn[e](n,r[0]):void 0===Kt.tcModel?this.callQueue.push([e,t,n,...r]):this.isCustomCommand(e)&&this.isBuiltInCommand(e)?new Mn[e](this.customCommands[e],r[0],null,n):new Mn[e](n,r[0]):n(null,!1)}else n(null,!1)}purgeQueuedCalls(){const e=this.callQueue;this.callQueue=[],e.forEach((e=>{window[Gn](...e)}))}isCustomCommand(e){return this.customCommands&&"function"==typeof this.customCommands[e]}isBuiltInCommand(e){return void 0!==Mn[e]}}class Wn{callResponder;isServiceSpecific;numUpdates=0;constructor(e,t,n=!1,r){this.throwIfInvalidInt(e,"cmpId",2),this.throwIfInvalidInt(t,"cmpVersion",0),Kt.cmpId=e,Kt.cmpVersion=t,Kt.tcfPolicyVersion=2,this.isServiceSpecific=!!n,this.callResponder=new Fn(r)}throwIfInvalidInt(e,t,n){if(!("number"==typeof e&&Number.isInteger(e)&&e>=n))throw new Error(`Invalid ${t}: ${e}`)}update(e,t=!1){if(Kt.disabled)throw new Error("CmpApi Disabled");Kt.cmpStatus=Et.LOADED,t?(Kt.displayStatus=Tt.VISIBLE,Kt.eventStatus=Lt.CMP_UI_SHOWN):void 0===Kt.tcModel?(Kt.displayStatus=Tt.DISABLED,Kt.eventStatus=Lt.TC_LOADED):(Kt.displayStatus=Tt.HIDDEN,Kt.eventStatus=Lt.USER_ACTION_COMPLETE),(Kt.gdprApplies=null!==e)?(""===e?((Kt.tcModel=new jn).cmpId=Kt.cmpId,Kt.tcModel.cmpVersion=Kt.cmpVersion):Kt.tcModel=xn.decode(e),Kt.tcModel.isServiceSpecific=this.isServiceSpecific,Kt.tcfPolicyVersion=Number(Kt.tcModel.policyVersion),Kt.tcString=e):Kt.tcModel=null,0===this.numUpdates?this.callResponder.purgeQueuedCalls():Kt.eventQueue.exec(),this.numUpdates++}disable(){Kt.disabled=!0,Kt.cmpStatus=Et.ERROR}}var Hn=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Bn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},qn=function(e,t){return function(n,r){t(n,r,e)}},Qn=function(){function e(e,t){var n=this;this.window=e,this.logger=t,this.IAB_PURPOSES_COUNT=10,this.TCF_API_VERSION=2,this.CMP_VERSION=5,this.CMP_ID=141,this.initializeTcfApi(),this.consentGiven=new Promise((function(e){return n.resolveConsent=e})),this.readTrackingConsents(),this.subscribe()}var t,n;return e.prototype.initializeTcfApi=function(){void 0===this.window.__uspapi&&void 0===this.window.__tcfapi&&new Wn(this.CMP_ID,this.CMP_VERSION,!0)},e.prototype.subscribe=function(){this.window.__tcfapi&&this.window.__tcfapi("addEventListener",this.TCF_API_VERSION,this.handleTcfSubscriptionResponse.bind(this))},e.prototype.handleTcfSubscriptionResponse=function(e){if("useractioncomplete"===(null==e?void 0:e.eventStatus)||"tcloaded"===(null==e?void 0:e.eventStatus)){var t=this.detectTcfTrackingConsent(e);this.consentsUpdated(t),this.window.__tcfapi("removeEventListener",this.TCF_API_VERSION,null,e.listenerId)}},e.prototype.readTrackingConsents=function(){this.window.__tcfapi&&this.window.__tcfapi("getTCData",this.TCF_API_VERSION,this.handleReadConsentsResponse.bind(this))},e.prototype.handleReadConsentsResponse=function(e){if("useractioncomplete"===(null==e?void 0:e.eventStatus)||"tcloaded"===(null==e?void 0:e.eventStatus)){var t=this.detectTcfTrackingConsent(e);this.consentsUpdated(t)}},e.prototype.detectTcfTrackingConsent=function(e){return!!(null==e?void 0:e.purpose)&&Object.keys(e.purpose.consents).map((function(t){return e.purpose.consents[t]})).reduce((function(e,t){return t+e}),0)===this.IAB_PURPOSES_COUNT},e.prototype.consentsUpdated=function(e){this.logger.info("Consents ready"),this.resolveConsent({gdprConsent:e,geoRequiresConsent:!0,geoRequiresSignal:!1,ccpaSignal:!1})},e=Hn([ee(),qn(0,X("window")),qn(1,te(Ge.Logger,Ge.LoggerTransformer,"TCF")),Bn("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object,"function"==typeof(n=void 0!==Ge.Logger&&Ge.Logger)?n:Object])],e)}(),zn={};r(zn,"UspApi",(()=>Jn),(e=>Jn=e));var $n=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Yn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Kn=function(e,t){return function(n,r){t(n,r,e)}},Jn=function(){function e(e){var t=this;this.window=e,this.USP_API_VERSION=1,this.CCPA_TRACKING_ALLOWED="1YN",this.queue=[],this.consentGiven=new Promise((function(e){return t.resolveConsent=e}))}var t;return e.prototype.installUspApi=function(){this.window.__uspapi=this.uspApiMessage.bind(this),this.addLocatorFrame(),this.addUspMessageListener()},e.prototype.consentsUpdated=function(e){this.resolveConsent({gdprConsent:!0,geoRequiresConsent:!1,geoRequiresSignal:!0,ccpaSignal:!e.startsWith(this.CCPA_TRACKING_ALLOWED)})},e.prototype.uspApiMessage=function(e,t,n){"ping"===e?n({uspapiLoaded:!1},!0):"getQueue"===e?n(this.queue,!0):this.queue.push([e,t,n])},e.prototype.addLocatorFrame=function(){var e=this,t="__uspapi";if(!this.window.frames[t])if("loading"!==document.readyState){var n=document.createElement("iframe");n.name=t,n.style.display="none",document.body.appendChild(n)}else document.addEventListener("DOMContentLoaded",(function(){return e.addLocatorFrame()}))},e.prototype.addUspMessageListener=function(){var e=this;this.window.addEventListener("message",(function(t){var n=e.convertUspMessageData(t);n&&e.uspMessageHandler(n,t)}),!1)},e.prototype.convertUspMessageData=function(e){try{return("string"==typeof e.data?JSON.parse(e.data):e.data).__uspapiCall}catch(e){}},e.prototype.uspMessageHandler=function(e,t){this.window.__uspapi(e.command,e.version,(function(n,r){var o={__uspapiReturn:{returnValue:n,success:r,callId:e.callId}};t.source.postMessage(o,"*")}))},e.prototype.subscribe=function(){this.window.__uspapi&&this.window.__uspapi("addEventListener",this.USP_API_VERSION,this.consentsUpdated.bind(this))},e.prototype.readTrackingConsents=function(){this.window.__uspapi&&this.window.__uspapi("getUSPData",this.USP_API_VERSION,this.consentsUpdated.bind(this))},e=$n([ee(),Kn(0,X("window")),Yn("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object])],e)}(),Xn={};r(Xn,"ConsentProviderFactory",(()=>nr),(e=>nr=e));var Zn=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},er=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},tr=function(e,t){return function(n,r){t(n,r,e)}},nr=function(){function e(e,t,n){this.window=e,this.logger=t,this.cookiesManager=n}var t,n,r;return e.prototype.getLocation=function(){var e,t;if(this.window.OneTrust&&this.window.OneTrust.getGeolocationData())return null===(e=this.window.OneTrust.getGeolocationData().country)||void 0===e?void 0:e.toLowerCase();var n=this.cookiesManager.get("Geo");return n?null===(t=JSON.parse(n))||void 0===t?void 0:t.country.toLowerCase():void 0},e.prototype.get=function(){var e=this.getLocation();if(e)if("us"===e)this.logger.info("CCPA location"),this.consentProvider=J.resolve(zn.UspApi);else{if(!Ft.includes(e))return this.logger.info("Privacy policy is not required"),Promise.resolve({gdprConsent:!0,geoRequiresSignal:!1,geoRequiresConsent:!1,ccpaSignal:!1});this.consentProvider=J.resolve(Qt.TcfApi),this.logger.info("__tcfapi installed")}var t=J.resolve(Rt.OneTrust);this.logger.info("OneTrust installed");var n=[t.consentGiven];return this.consentProvider&&n.push(this.consentProvider.consentGiven),Promise.race(n)},e=Zn([ee(),tr(0,X("window")),tr(1,te(Ge.Logger,Ge.LoggerTransformer,"OptInService")),tr(2,X("Cookies")),er("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object,"function"==typeof(n=void 0!==Ge.Logger&&Ge.Logger)?n:Object,"function"==typeof(r="undefined"!=typeof CookiesManager&&CookiesManager)?r:Object])],e)}(),rr={};r(rr,"OptInService",(()=>Ho),(e=>Ho=e));var or={};r(or,"Action",(()=>ir)),r(or,"eventsRepository",(()=>Uo));var ir=function(e,t){this.__global=!0,this.timestamp=Date.now(),this.name=e.name,this.category=e.category||"[Identity]",this.type="".concat(this.category," ").concat(e.name),Object.assign(this,t)},sr={};r(sr,"CommunicationService",(()=>Mo),(e=>Mo=e));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var ar=function(){return ar=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ar.apply(this,arguments)},cr={channelId:"default",host:window,coordinatorHost:window.top},ur={connect:"connect",connected:"connected"},lr="@wikia/post-quecast";function pr(e){return e.channelId&&e.libId===lr&&e.action&&function(e){return"string"==typeof e.type&&"number"==typeof e.timestamp}(e.action)}function fr(e){return!e.data.private}function dr(e,t){return e.data.channelId===t}function hr(e){return e.data.action}var gr=function(){function e(){}return e.make=function(e){return function(e){var t;return e.host===e.coordinatorHost&&!!(null===(t=e.coordinatorHost[lr])||void 0===t?void 0:t.callbackConnector)}(e)?e.coordinatorHost[lr].callbackConnector:new yr({senderHost:e.coordinatorHost,listenerHost:e.host})},e}(),vr=function(){function e(e){this.coordinatorHost=e,this.callbacks=[]}return e.prototype.dispatch=function(e){var t=this;if(!pr(e))throw new Error("Incorrect object type. Expected PostMessageData, but got "+e);this.callbacks.forEach((function(n){return n({data:e,source:t.coordinatorHost})}))},e.prototype.addListener=function(e){this.callbacks.push(e)},e.prototype.removeListener=function(e){this.callbacks=this.callbacks.filter((function(t){return t!==e}))},e}(),yr=function(){function e(e){this.options=e,this.map=new Map}return e.prototype.dispatch=function(e){if(!pr(e))throw new Error("Incorrect object type. Expected PostMessageData, but got "+e);this.options.senderHost.postMessage(e,"*")},e.prototype.addListener=function(e){var t=function(t){var n;(n=t)&&n.source&&n.data&&pr(n.data)&&e(t)};this.map.set(e,t),this.options.listenerHost.addEventListener("message",t)},e.prototype.removeListener=function(e){var t=this.map.get(e);this.options.listenerHost.removeEventListener("message",t),this.map.delete(e)},e}(),mr=function(){function e(e){this.callbacks=[],this.history=[],this.channelId=e.channelId,this.connector=gr.make(e),this.setupActions(),this.setupConnection()}return e.prototype.setupActions=function(){this.getHistory(),this.listenEvent()},e.prototype.getHistory=function(){var e=this,t=function(n){if(dr(n,e.channelId)&&function(e){return!!e.data.private}(n)){var r=hr(n);(function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.some((function(t){return e.type===t}))})(r,ur.connected)&&(e.connector.removeListener(t),e.handleActions.apply(e,r.history))}};this.connector.addListener(t)},e.prototype.listenEvent=function(){var e=this;this.connector.addListener((function(t){if(dr(t,e.channelId)&&fr(t)){var n=hr(t);e.handleActions(n)}}))},e.prototype.handleActions=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];(e=this.history).push.apply(e,n),n.forEach((function(e){return t.callbacks.forEach((function(t){return t(e)}))}))},e.prototype.setupConnection=function(){this.connector.dispatch({action:{type:ur.connect,timestamp:Date.now()},channelId:this.channelId,private:!0,libId:lr})},e.prototype.addListener=function(e){this.history.forEach((function(t){return e(t)})),this.callbacks.push(e)},e.prototype.removeListener=function(e){this.callbacks=this.callbacks.filter((function(t){return t!==e}))},e}(),br=function(){function e(e){void 0===e&&(e={});var t=ar(ar({},cr),e);this.channelId=t.channelId,this.connector=gr.make(t)}return e.prototype.dispatch=function(e){this.connector.dispatch({action:ar(ar({},e),{timestamp:Date.now()}),channelId:this.channelId,private:!0,libId:lr})},e}(),wr=function(){function e(e){void 0===e&&(e={});var t=ar(ar({},cr),e);this.transmitter=new br(t),this.receiver=new mr(t)}return e.prototype.dispatch=function(e){this.transmitter.dispatch(e)},e.prototype.addListener=function(e){this.receiver.addListener(e)},e.prototype.removeListener=function(e){this.receiver.removeListener(e)},e}(),Sr=function(){function e(e,t){this.channelId=e,this.connectors=new Map,this.history=[],this.connectors.set(t,t[lr].callbackConnector)}return e.prototype.addConnection=function(e){this.ensureConnector(e).dispatch({action:this.createConnectedAction(),private:!0,channelId:this.channelId,libId:lr})},e.prototype.createConnectedAction=function(){return{type:ur.connected,history:this.history,timestamp:Date.now()}},e.prototype.broadcast=function(e){var t=this;this.history.push(e),this.connectors.forEach((function(n){n.dispatch({action:e,channelId:t.channelId,libId:lr})}))},e.prototype.ensureConnector=function(e){return this.connectors.has(e)||this.connectors.set(e,new yr({senderHost:e,listenerHost:e})),this.connectors.get(e)},e}(),Cr=function(){function e(e){this.coordinatorHost=e,this.channels=new Map,this.callbackConnector=new vr(e),this.postMessageConnector=new yr({senderHost:e,listenerHost:e})}return e.prototype.init=function(){var e=this,t=function(t){fr(t)||(e.handleConnect(t),e.handleBroadcast(t))};this.callbackConnector.addListener(t),this.postMessageConnector.addListener(t)},e.prototype.handleConnect=function(e){(function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.some((function(t){return e.data.action.type===t}))})(e,ur.connect)&&this.ensureChannel(e.data.channelId).addConnection(e.source)},e.prototype.handleBroadcast=function(e){(function(e){return!Object.values(ur).some((function(t){return e.data.action.type===t}))})(e)&&this.ensureChannel(e.data.channelId).broadcast(e.data.action)},e.prototype.ensureChannel=function(e){return this.channels.has(e)||this.channels.set(e,new Sr(e,this.coordinatorHost)),this.channels.get(e)},e}();function Ir(e){if(void 0===e&&(e=window),!e[lr]){var t=new Cr(e);t.init(),e[lr]=t}}var Rr=function(e,t){return Rr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Rr(e,t)};function Or(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Rr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function _r(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function Er(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function kr(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Tr(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Pr(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function Lr(e){return this instanceof Lr?(this.v=e,this):new Lr(e)}function Ar(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof Lr?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function jr(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=kr(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}Object.create;function xr(e){return"function"==typeof e}function Dr(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Vr=Dr((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function Nr(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Mr=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=kr(i),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(xr(c))try{c()}catch(e){o=e instanceof Vr?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=kr(u),p=l.next();!p.done;p=l.next()){var f=p.value;try{Fr(f)}catch(e){o=null!=o?o:[],e instanceof Vr?o=Pr(Pr([],Tr(o)),Tr(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new Vr(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Fr(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Nr(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&Nr(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Ur=Mr.EMPTY;function Gr(e){return e instanceof Mr||e&&"closed"in e&&xr(e.remove)&&xr(e.add)&&xr(e.unsubscribe)}function Fr(e){xr(e)?e():e.unsubscribe()}var Wr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Hr={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Hr.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,Pr([e,t],Tr(n))):setTimeout.apply(void 0,Pr([e,t],Tr(n)))},clearTimeout:function(e){var t=Hr.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Br(e){Hr.setTimeout((function(){var t=Wr.onUnhandledError;if(!t)throw e;t(e)}))}function qr(){}var Qr=$r("C",void 0,void 0);function zr(e){return $r("N",e,void 0)}function $r(e,t,n){return{kind:e,value:t,error:n}}var Yr=null;function Kr(e){if(Wr.useDeprecatedSynchronousErrorHandling){var t=!Yr;if(t&&(Yr={errorThrown:!1,error:null}),e(),t){var n=Yr,r=n.errorThrown,o=n.error;if(Yr=null,r)throw o}}else e()}var Jr=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Gr(t)&&t.add(n)):n.destination=oo,n}return Or(t,e),t.create=function(e,t,n){return new to(e,t,n)},t.prototype.next=function(e){this.isStopped?ro(zr(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?ro($r("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?ro(Qr,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Mr),Xr=Function.prototype.bind;function Zr(e,t){return Xr.call(e,t)}var eo=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){no(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){no(e)}else no(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){no(e)}},e}(),to=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;xr(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Wr.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&Zr(t.next,i),error:t.error&&Zr(t.error,i),complete:t.complete&&Zr(t.complete,i)}):o=t;return s.destination=new eo(o),s}return Or(t,e),t}(Jr);function no(e){var t;Wr.useDeprecatedSynchronousErrorHandling?(t=e,Wr.useDeprecatedSynchronousErrorHandling&&Yr&&(Yr.errorThrown=!0,Yr.error=t)):Br(e)}function ro(e,t){var n=Wr.onStoppedNotification;n&&Hr.setTimeout((function(){return n(e,t)}))}var oo={closed:!0,next:qr,error:function(e){throw e},complete:qr},io="function"==typeof Symbol&&Symbol.observable||"@@observable";function so(e){return e}function ao(e){return 0===e.length?so:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var co=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof Jr||function(e){return e&&xr(e.next)&&xr(e.error)&&xr(e.complete)}(r)&&Gr(r)?e:new to(e,t,n);return Kr((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=uo(t))((function(t,r){var o=new to({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[io]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ao(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=uo(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function uo(e){var t;return null!==(t=null!=e?e:Wr.Promise)&&void 0!==t?t:Promise}function lo(e){return function(t){if(function(e){return xr(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function po(e,t,n,r,o){return new fo(e,t,n,r,o)}var fo=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Or(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Jr);var ho=Array.isArray;function go(e){return t=function(t){return function(e,t){return ho(t)?e.apply(void 0,Pr([],Tr(t))):e(t)}(e,t)},lo((function(e,r){var o=0;e.subscribe(po(r,(function(e){r.next(t.call(n,e,o++))})))}));var t,n}function vo(e,t,n){return n?vo(e,t).pipe(go(n)):new co((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)},o=e(r);return xr(t)?function(){return t(r,o)}:void 0}))}var yo=Dr((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),mo=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Or(t,e),t.prototype.lift=function(e){var t=new bo(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new yo},t.prototype.next=function(e){var t=this;Kr((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=kr(t.currentObservers),i=o.next();!i.done;i=o.next()){i.value.next(e)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Kr((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Kr((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?Ur:(this.currentObservers=null,i.push(e),new Mr((function(){t.currentObservers=null,Nr(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new co;return e.source=this,e},t.create=function(e,t){return new bo(e,t)},t}(co),bo=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Or(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Ur},t}(mo),wo={now:function(){return(wo.delegate||Date).now()},delegate:void 0},So=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=wo);var o=e.call(this)||this;return o._bufferSize=t,o._windowTime=n,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,n),o}return Or(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,o=n._buffer,i=n._infiniteTimeWindow,s=n._timestampProvider,a=n._windowTime;r||(o.push(t),!i&&o.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=n?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,o=e._infiniteTimeWindow,i=(o?1:2)*t;if(t<1/0&&i<r.length&&r.splice(0,r.length-i),!o){for(var s=n.now(),a=0,c=1;c<r.length&&r[c]<=s;c+=2)a=c;a&&r.splice(0,a+1)}},t}(mo),Co=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Io(e){return xr(e[io])}function Ro(e){return Symbol.asyncIterator&&xr(null==e?void 0:e[Symbol.asyncIterator])}function Oo(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var _o="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Eo(e){return xr(null==e?void 0:e[_o])}function ko(e){return xr(null==e?void 0:e.getReader)}function To(e){if(e instanceof co)return e;if(null!=e){if(Io(e))return i=e,new co((function(e){var t=i[io]();if(xr(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Co(e))return o=e,new co((function(e){for(var t=0;t<o.length&&!e.closed;t++)e.next(o[t]);e.complete()}));if(xr(null==(r=e)?void 0:r.then))return n=e,new co((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Br)}));if(Ro(e))return Po(e);if(Eo(e))return t=e,new co((function(e){var n,r;try{for(var o=kr(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(ko(e))return Po(function(e){return Ar(this,arguments,(function(){var t,n,r;return Er(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Lr(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,Lr(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Lr(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,n,r,o,i;throw Oo(e)}function Po(e){return new co((function(t){(function(e,t){var n,r,o,i;return _r(this,void 0,void 0,(function(){var s,a;return Er(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=jr(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Lo(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new mo}:t,r=e.resetOnError,o=void 0===r||r,i=e.resetOnComplete,s=void 0===i||i,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,r,i,a=0,u=!1,l=!1,p=function(){null==r||r.unsubscribe(),r=void 0},f=function(){p(),t=i=void 0,u=l=!1},d=function(){var e=t;f(),null==e||e.unsubscribe()};return lo((function(e,h){a++,l||u||p();var g=i=null!=i?i:n();h.add((function(){0!==--a||l||u||(r=Ao(d,c))})),g.subscribe(h),!t&&a>0&&(t=new to({next:function(e){return g.next(e)},error:function(e){l=!0,p(),r=Ao(f,o,e),g.error(e)},complete:function(){u=!0,p(),r=Ao(f,s),g.complete()}}),To(e).subscribe(t))}))(e)}}function Ao(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var o=new to({next:function(){o.unsubscribe(),e()}});return To(t.apply(void 0,Pr([],Tr(n)))).subscribe(o)}}else e()}function jo(e,t,n){var r,o,i,s,a=!1;return e&&"object"==typeof e?(r=e.bufferSize,s=void 0===r?1/0:r,o=e.windowTime,t=void 0===o?1/0:o,a=void 0!==(i=e.refCount)&&i,n=e.scheduler):s=null!=e?e:1/0,Lo({connector:function(){return new So(s,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}var xo=new co((function(e){return e.complete()}));var Do=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Vo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},No=function(e,t){return function(n,r){t(n,r,e)}},Mo=function(){function e(e){var t,n=this;this.window=e;var r=(t=this.getSettings()).channelId,o=t.coordinatorName;Ir(),this.communicator=new wr({channelId:r||"default",coordinatorHost:e[o]||top}),this.actions$=vo((function(e){return n.communicator.addListener(e)}),(function(e){return n.communicator.removeListener(e)})).pipe(jo({refCount:!0}))}var t;return e.prototype.emit=function(e){this.communicator.dispatch(e)},e.prototype.on=function(e,t){this.actions$.pipe(this.ofType(e)).subscribe(t)},e.prototype.once=function(e,t){var n;this.actions$.pipe(this.ofType(e),(n=1,n<=0?function(){return xo}:lo((function(e,t){var r=0;e.subscribe(po(t,(function(e){++r<=n&&(t.next(e),n<=r&&t.complete())})))})))).subscribe(t)},e.prototype.getSettings=function(){return this.window["@wikia/post-quecast-settings"]||{}},e.prototype.ofType=function(e){return function(t){return t.pipe((n=function(t){return t.category===e.category&&t.name===e.name||t.type===e.category+" "+e.name},lo((function(e,t){var o=0;e.subscribe(po(t,(function(e){return n.call(r,e,o++)&&t.next(e)})))}))));var n,r}},e=Do([Z(),No(0,X("window")),Vo("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object])],e)}(),Uo={CONSENT_READY:{category:"[AdEngine OptIn]",name:"set opt in"},IDENTITY_READY:{category:"[IdentityEngine]",name:"Identity ready"},IDENTITY_PARTNER_DATA_OBTAINED:{category:"[AdEngine]",name:"Identity partner data obtained"}};n(or,sr);var Go=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Fo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Wo=function(e,t){return function(n,r){t(n,r,e)}},Ho=function(){function e(e,t,n){var r,o=this;this.communicationService=e,this.logger=n,this._trackingAllowed=!1,this.consentProvider=t.get(),null===(r=this.consentProvider)||void 0===r||r.then((function(e){o.logger.info("Sending consents: ",e),o.sendConsentsToAdEngine(e)}))}var t,n,r;return Object.defineProperty(e.prototype,"trackingAllowed",{get:function(){return this._trackingAllowed},set:function(e){this._trackingAllowed=e},enumerable:!1,configurable:!0}),e.prototype.sendConsentsToAdEngine=function(e){this.communicationService.emit(new ir(Uo.CONSENT_READY,e))},e=Go([ee(),Wo(0,X(sr.CommunicationService)),Wo(1,X(Xn.ConsentProviderFactory)),Wo(2,te(Ge.Logger,Ge.LoggerTransformer,"OptInService")),Fo("design:paramtypes",["function"==typeof(t=void 0!==sr.CommunicationService&&sr.CommunicationService)?t:Object,"function"==typeof(n=void 0!==Xn.ConsentProviderFactory&&Xn.ConsentProviderFactory)?n:Object,"function"==typeof(r=void 0!==Ge.Logger&&Ge.Logger)?r:Object])],e)}();n(wt,St),n(wt,Rt),n(wt,Qt),n(wt,zn),n(wt,Xn),n(wt,rr);var Bo,qo,Qo=function(){return Qo=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Qo.apply(this,arguments)},zo=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},$o=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Yo=function(e,t){return function(n,r){t(n,r,e)}},Ko=function(){function e(e,t,n,r,o,i){this.logger=e,this.httpClient=t,this.skin=n,this.optInService=r,this.window=o,this.wikiConfig=i,this.dataWarehouseUrl="https://beacon.wikia-services.com/__track/special/identityinfo"}var t,n,r,o,i,s;return e.prototype.send=function(e){this.sendEvent(e,this.dataWarehouseUrl)},e.prototype.sendEvent=function(e,t){var n=Qo(Qo(Qo({},e),this.getTimeBasedParams()),this.getTrackingParams()),r=this.buildDataWarehouseUrl(n,t);r&&this.httpClient.get(r)},e.prototype.getTrackingParams=function(){var e,t,n,r,o,i,s,a,c,u,l,p,f;return{session_id:null===(t=null===(e=this.window.fandomContext)||void 0===e?void 0:e.tracking)||void 0===t?void 0:t.sessionId,pv_number:null===(r=null===(n=this.window.fandomContext)||void 0===n?void 0:n.tracking)||void 0===r?void 0:r.pvNumber,pv_number_global:null===(i=null===(o=this.window.fandomContext)||void 0===o?void 0:o.tracking)||void 0===i?void 0:i.pvNumberGlobal,pv_unique_id:null===(a=null===(s=this.window.fandomContext)||void 0===s?void 0:s.tracking)||void 0===a?void 0:a.pvUID,beacon:null===(u=null===(c=this.window.fandomContext)||void 0===c?void 0:c.tracking)||void 0===u?void 0:u.beaconId,ua:null===(l=this.window.navigator)||void 0===l?void 0:l.userAgent,c:this.wikiConfig.get("wgCityId")||"unknown",ck:this.wikiConfig.get("dsSiteKey")||"unknown",lc:this.wikiConfig.get("wgUserLanguage")||"unknown",s:this.skin.get(),u:this.optInService.trackingAllowed?this.wikiConfig.get("wgUserId")||0:-1,a:(null===(f=null===(p=this.window.fandomContext)||void 0===p?void 0:p.page)||void 0===f?void 0:f.articleId)||-1,x:this.wikiConfig.get("wgDBname")||"unknown",n:this.wikiConfig.get("wgNamespaceNumber")||-1}},e.prototype.getTimeBasedParams=function(){return{cb:Math.floor(99999*Math.random()),url:document.URL}},e.prototype.buildDataWarehouseUrl=function(e,t){if(t){var n=new URLSearchParams(e);return n.sort(),"".concat(t,"?").concat(n.toString())}this.logger.error("Error building DWH tracking URL")},e=zo([Z(),Yo(0,te(Ge.Logger,Ge.LoggerTransformer,"DataWarehouseService")),Yo(1,X(De.HttpClient)),Yo(2,X(gt.Skin)),Yo(3,X(rr.OptInService)),Yo(4,X("window")),Yo(5,X(rt.WikiConfig)),$o("design:paramtypes",["function"==typeof(t=void 0!==Ge.Logger&&Ge.Logger)?t:Object,"function"==typeof(n=void 0!==De.HttpClient&&De.HttpClient)?n:Object,"function"==typeof(r=void 0!==gt.Skin&&gt.Skin)?r:Object,"function"==typeof(o=void 0!==rr.OptInService&&rr.OptInService)?o:Object,"function"==typeof(i="undefined"!=typeof Window&&Window)?i:Object,"function"==typeof(s=void 0!==rt.WikiConfig&&rt.WikiConfig)?s:Object])],e)}(),Jo=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Xo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Zo=function(e,t){return function(n,r){t(n,r,e)}};(qo=Bo||(Bo={}))[qo.identity=0]="identity";var ei=function(){function e(e,t){this.logger=e,this.identityEventSender=t}var t,n;return e.prototype.track=function(e,t){if(e===Bo.identity)this.identityEventSender.send(t);else this.logger.info("Invalid event type to track")},e=Jo([Z(),Zo(0,te(Ge.Logger,Ge.LoggerTransformer,"DataWarehouseService")),Zo(1,X(ht.IdentityEventSender)),Xo("design:paramtypes",["function"==typeof(t=void 0!==Ge.Logger&&Ge.Logger)?t:Object,"function"==typeof(n=void 0!==ht.IdentityEventSender&&ht.IdentityEventSender)?n:Object])],e)}();n(ft,dt),n(ft,ht);var ti={};r(ti,"HemTrackingService",(()=>si),(e=>si=e));var ni=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ri=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},oi=function(e,t){return function(n,r){t(n,r,e)}},ii=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},si=function(){function e(e,t,n){this.dataWarehouse=e,this.window=t,this.logger=n}var t,n,r;return e.prototype.activateTracking=function(){var e=this;if(this.isEnabled()){var t=this.extractHEMs();Object.keys(t).forEach((function(n){t[n]&&e.dataWarehouse.track(dt.DataWarehouseEventType.identity,{partner_name:"MediaWiki-"+n,partner_identity_id:t[n]})}))}else this.logger.info("Hem Tracking is disabled")},e.prototype.isEnabled=function(){var e,t,n;return(null===(n=null===(t=null===(e=this.window.ads)||void 0===e?void 0:e.context)||void 0===t?void 0:t.opts)||void 0===n?void 0:n.userEmailHashes)&&this.window.ads.context.opts.userEmailHashes.length>0},e.prototype.extractHEMs=function(){var e;return{md5:(e=ii(this.window.ads.context.opts.userEmailHashes,3))[0],sha1:e[1],sha256:e[2]}},e=ni([Z(),oi(0,X(dt.DataWarehouseService)),oi(1,X("window")),oi(2,te(Ge.Logger,Ge.LoggerTransformer,"HemTracking")),ri("design:paramtypes",["function"==typeof(t=void 0!==dt.DataWarehouseService&&dt.DataWarehouseService)?t:Object,"function"==typeof(n="undefined"!=typeof Window&&Window)?n:Object,"function"==typeof(r=void 0!==Ge.Logger&&Ge.Logger)?r:Object])],e)}(),ai={};r(ai,"InstantConfigService",(()=>ps),(e=>ps=e));var ci={};function ui(e,t){return Object.keys(t).forEach((function(n){"default"===n||"__esModule"===n||e.hasOwnProperty(n)||Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})})),e}function li(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}li(ci,"utils",(()=>pi));var pi={},fi={};function di(e){return new Promise((t=>setTimeout((()=>t()),e)))}li(fi,"delay",(()=>di));var hi={};function gi(){const e=new URLSearchParams(window.location.search.substring(1));return Boolean(e.get("adengine_debug"))?e.get("adengine_debug"):e.get("identity_debug")}li(hi,"getDebugGroup",(()=>gi));var vi={};li(vi,"localStorageHelper",(()=>yi));class yi{constructor(e,t=6e4){this.key=e,this.ttlInMilliseconds=t}expired(e){return!e||e<Date.now()}getObjectToStore(e){return{data:e,ttl:Date.now()+this.ttlInMilliseconds}}parseStoredValue(e){const t=JSON.parse(e);return this.expired(t?.ttl)?null:t.data}get(){const e=localStorage.getItem(this.key);return e?this.parseStoredValue(e):null}set(e){const t=this.getObjectToStore(e);localStorage.setItem(this.key,JSON.stringify(t))}}var mi={};li(mi,"lock",(()=>wi)),li(mi,"release",(()=>Si));const bi=new yi("instant-config-lock",1e3);function wi(){return"lock"===bi.get()||(bi.set("lock"),!1)}function Si(){bi.set(null)}var Ci={};li(Ci,"getTimeDelta",(()=>_i)),li(Ci,"logger",(()=>Ei)),li(Ci,"warner",(()=>ki));const Ii=gi()||"",Ri=Ii.split(","),Oi=Date.now();function _i(){return((Date.now()-(window.performance?.timeOrigin??Oi))/1e3).toFixed(4)}function Ei(e,...t){""!==Ii&&("1"!==Ii&&-1===Ri.indexOf(e)||window.console.info(`${_i()}s\t\t ${e}`,t))}function ki(e,...t){""!==Ii&&("1"!==Ii&&-1===Ri.indexOf(e)||window.console.warn(e,t))}ui(pi,Ci),ui(pi,fi),ui(pi,hi),ui(pi,vi),ui(pi,mi);var Ti={},Pi={};li(Pi,"EmptyInstantConfigCacheStorage",(()=>Li));class Li{get(e){}set(e){}}var Ai={};li(Ai,"InstantConfigInterpreter",(()=>Xi));var ji={},xi={};li(xi,"BrowserMatcher",(()=>Wi));var Di={};li(Di,"extractNegation",(()=>Fi));var Vi={},Ni={};li(Ni,"negativePrefix",(()=>Mi)),li(Ni,"cacheSuffix",(()=>Ui)),li(Ni,"samplingSeparator",(()=>Gi));const Mi="non-",Ui="-cached",Gi="/";function Fi(e){return e.startsWith(Mi)?{value:e.replace(Mi,""),negated:!0}:{value:e,negated:!1}}ui(Vi,{}),ui(Vi,{}),ui(Vi,{}),ui(Vi,{}),ui(Vi,{}),ui(Vi,{}),ui(Vi,{}),ui(Vi,Ni),ui(Vi,{}),ui(Vi,{});class Wi{constructor(e){this.currentBrowser=e?.toLowerCase()}isValid(e=[]){const t=e.map((e=>e.toLowerCase())).map((e=>Fi(e)));return 0===e.length||(!this.currentBrowser||!this.isCurrentNegated(this.currentBrowser,t)&&t.some((e=>this.currentBrowser.includes(e.value)!==e.negated)))}isCurrentNegated(e,t){return t.some((t=>e.includes(t.value)&&t.negated))}}var Hi={};li(Hi,"DeviceMatcher",(()=>Bi));class Bi{constructor(e){this.currentDevice=e}isValid(e=[]){const t=e.map((e=>e.toLowerCase())).map((e=>Fi(e)));return 0===t.length||(!this.currentDevice||!this.isCurrentNegated(this.currentDevice,t)&&t.some((e=>e.value===this.currentDevice!==e.negated)))}isCurrentNegated(e,t){return t.some((t=>e.includes(t.value)&&t.negated))}}var qi={};li(qi,"DomainMatcher",(()=>Qi));class Qi{isValid(e=[]){return 0===e.length||e.some((e=>window.location.hostname.includes(e)))}}var zi={};li(zi,"RegionMatcher",(()=>Yi));const $i=()=>!0;class Yi{isValid(e=[],t=$i){return t(this.filterOutInvalidRegions(e))}filterOutInvalidRegions(e){return e.filter((e=>!e.includes(Gi))).filter((e=>!e.includes(Ui)))}}var Ki={};li(Ki,"SamplingCacheManager",(()=>Ji));class Ji{constructor(e){this.cacheStorage=e,this.precision=10**6}apply(e,t,n){const r=this.cacheStorage.get(e);if(void 0!==r)return r.result;const o=n();if("number"!=typeof t.sampling||!1===o)return o;const i=this.getSamplingResult(t.sampling),s={name:e,result:i,withCookie:Boolean(t.samplingCache),group:i?"B":"A",limit:+(i?t.sampling:100-t.sampling).toFixed(6)};return this.cacheStorage.set(s),i}getSamplingResult(e){const t=Math.round(100*Math.random()*this.precision);return Math.round(e*this.precision)>t}}ui(ji,xi),ui(ji,Hi),ui(ji,qi),ui(ji,Di),ui(ji,zi),ui(ji,Ki);class Xi{constructor(e=new Wi,t=new Bi,n=new Qi,r=new Yi,o=new Li){this.browserMatcher=e,this.deviceMatcher=t,this.domainMatcher=n,this.regionMatcher=r,this.instantConfigCacheService=o,this.logGroup="instant-config-interpreter",this.configResponse={},this.samplingCache=new Ji(o)}init(e,t={},n){return this.configResponse={...t,...e},this.regionValidationPredicate=n,this}getValues(){return pi.logger(this.logGroup,"get values called with",this.configResponse),Object.keys(this.configResponse).map((e=>({key:e,value:this.configResponse[e]}))).map((({key:e,value:t})=>e.startsWith("wg")?{key:e,value:t}:{key:e,value:this.getValue(e,t)})).reduce(((e,t)=>({...e,[t.key]:t.value})),{})}getValue(e,t){const n=t.find(((t,n)=>this.samplingCache.apply(`${e}-${n}`,t,this.getPredicate(t))));if(void 0!==n)return n.value}getPredicate(e){return()=>this.browserMatcher.isValid(e.browsers)&&this.deviceMatcher.isValid(e.devices)&&this.domainMatcher.isValid(e.domains)&&this.regionMatcher.isValid(e.regions,this.regionValidationPredicate)}}var Zi={};async function es(e,t=2e3){const n=new AbortController,r=setTimeout((()=>n.abort()),t),o=await fetch(e,{signal:n.signal});return clearTimeout(r),o}li(Zi,"InstantConfigLoader",(()=>ns));const ts="instant-config-loader";class ns{constructor(e){this.params=e,this.configPromise=null,this.storage=new pi.localStorageHelper(`instant-config-${e.appName}`,6e4)}async getConfig(){return this.configPromise||(this.configPromise=this.fetchInstantConfig().then((e=>e??this.fetchFallbackConfig()))),this.configPromise.then((e=>e))}async fetchInstantConfig(e=!1){if(pi.lock()&&!e)return await di(500),this.fetchInstantConfig(!0);const t=`${this.params.instantConfigEndpoint??"https://services.fandom.com"}/${this.params.instantConfigVariant??"icbm"}/api/config?app=${this.params.appName}`;try{const e=this.storage.get();if(e)return pi.logger(ts,"instant config pulled from local storage",e),JSON.parse(e);const n=await es(t,this.params.requestTimeout);if(!n.ok)return;const r=await n.json();return this.storage.set(JSON.stringify(r)),pi.release(),pi.logger(ts,"instant config fetched",r),r}catch(e){return pi.warner(ts,"could not fetch instant config",e),void pi.release()}}async fetchFallbackConfig(){pi.logger(ts,"Fetching fallback config");const e=this.params.instantConfigFallbackEndpoint;if(void 0===e)return{};try{pi.logger(ts,e);const t=await es(e,this.params.requestTimeout);if(!t.ok)return{};const n=await t.json();return pi.logger(ts,"fallback config fetched",n),n}catch(e){return pi.warner(ts,"could not fetch fallback config",e),{}}}}var rs={};li(rs,"InstantConfigOverrider",(()=>is));const os=["InstantGlobals","icbm"];class is{override(e,t){return[...e.keys()].filter((e=>{return t=e,os.some((e=>t.startsWith(`${e}.`)||t.startsWith(`${e}__`)));var t})).map((e=>{const[,t]=e.split(".").map((e=>e.split("__"))).flat();return{paramKey:e,key:t}})).map((({paramKey:t,key:n})=>({key:n,value:this.parseValue(e.get(t))}))).map((({key:e,value:t})=>({key:e,value:e.startsWith("wg")?t:this.wrapValueInXXRegions(t)}))).reduce(((e,{key:t,value:n})=>({...e,[t]:n})),t)}parseValue(e){if("true"===e||"false"===e)return"true"===e;const t=parseInt(e,10);if(e===`${t}`)return t;try{return JSON.parse(e)}catch(t){return e||null}}wrapValueInXXRegions(e){return[{value:e,regions:["XX"]}]}}ui(Ti,Pi),ui(Ti,Ai),ui(Ti,Zi),ui(Ti,rs),ui(Ti,ji),ui(ci,Ti),ui(ci,Vi);var ss=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},as=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cs=function(e,t){return function(n,r){t(n,r,e)}},us=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},ls=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},ps=function(){function e(e,t,n,r){this.device=e,this.browser=t,this.platform=n,this.logger=r}var t,n,r,o;return e.prototype.init=function(e){return void 0===e&&(e={}),us(this,void 0,Promise,(function(){var t,n,r,o;return ls(this,(function(i){switch(i.label){case 0:return t=this.platform.get(),n=new(0,ci.InstantConfigLoader)({appName:t}),r=new(0,ci.InstantConfigInterpreter)(new(0,ci.BrowserMatcher)(this.browser.getBrowser()),new(0,ci.DeviceMatcher)(this.device.getDeviceType())),[4,n.getConfig().then((function(e){return(new(0,ci.InstantConfigOverrider)).override(Fe.getURLSearchParams(),e)})).then((function(t){return r.init(t,e)}))];case 1:return o=i.sent(),this.repository=o.getValues(),this.logger.info("instantiated with",this.repository),[2,this]}}))}))},e.prototype.get=function(e,t){return e in this.repository&&void 0!==this.repository[e]?this.repository[e]:t},e=ss([ee(),cs(0,X(he.Device)),cs(1,X(pe.Browser)),cs(2,X(qe.Platform)),cs(3,te(Ge.Logger,Ge.LoggerTransformer,"InstantConfig")),as("design:paramtypes",["function"==typeof(t=void 0!==he.Device&&he.Device)?t:Object,"function"==typeof(n=void 0!==pe.Browser&&pe.Browser)?n:Object,"function"==typeof(r=void 0!==qe.Platform&&qe.Platform)?r:Object,"function"==typeof(o=void 0!==Ge.Logger&&Ge.Logger)?o:Object])],e)}(),fs={};r(fs,"PageViewNumberGenerator",(()=>ms),(e=>ms=e));var ds,hs,gs=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},vs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ys=function(e,t){return function(n,r){t(n,r,e)}},ms=function(){function e(e){this.cookiesManager=e}var t;return e.prototype.getNextNumberFromCookie=function(e){var t=parseInt(this.cookiesManager.get(e));return Number.isNaN(t)?1:t+1},e=gs([Z(),ys(0,X("Cookies")),vs("design:paramtypes",["function"==typeof(t="undefined"!=typeof CookiesManager&&CookiesManager)?t:Object])],e)}(),bs={},ws={};r(ws,"PpidProvider",(()=>ba),(e=>ba=e)),(hs=ds||(ds={})).LOCAL="local",hs.IDENTITY_STORAGE="identity_storage";var Ss,Cs={};(Ss||(Ss={})).IDENTITY="identity";var Is={};r(Is,"IdentityStorageClient",(()=>Ts),(e=>Ts=e));var Rs=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Os=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_s=function(e,t){return function(n,r){t(n,r,e)}},Es=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},ks=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},Ts=function(){function e(e,t,n,r){this.logger=e,this.uuid=t,this.storage=n,this.serviceBaseUrl=r,this.logGroup="identity-storage",this.IdentityStorageKey="identity",this.ISUrl=this.serviceBaseUrl.get()+"identity-storage/"}var t,n,r;return e.prototype.fetchData=function(){return Es(this,void 0,Promise,(function(){var e,t,n=this;return ks(this,(function(r){return e=new AbortController,t=setTimeout((function(){return e.abort()}),1e3),[2,fetch(this.ISUrl,{mode:"cors",credentials:"include",signal:e.signal}).then((function(e){return clearTimeout(t),200===e.status||202===e.status?e.json():n.createFallbackResponse()})).catch((function(e){return n.logger.info(n.logGroup,"Loading Identity Storage data failed",e),n.createFallbackResponse()}))]}))}))},e.prototype.postData=function(e){return Es(this,void 0,Promise,(function(){return ks(this,(function(t){return[2,fetch(this.ISUrl+"identity",{credentials:"include",mode:"cors",headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify({ppid:e.ppid})}).then((function(e){return e.json()}))]}))}))},e.prototype.getLocalData=function(){return this.storage.getItem(this.IdentityStorageKey)},e.prototype.setLocalData=function(e){this.storage.setItem(this.IdentityStorageKey,e)},e.prototype.createFallbackResponse=function(){return{timestamp:Date.now(),over18:!1,synced:!1,ppid:this.uuid()}},e=Rs([ee(),_s(0,te(Ge.Logger,Ge.LoggerTransformer,"UserIdentity")),_s(1,X("uuid")),_s(2,X(Je.Storage)),_s(3,X($e.ServiceBaseUrl)),Os("design:paramtypes",["function"==typeof(t=void 0!==Ge.Logger&&Ge.Logger)?t:Object,Function,"function"==typeof(n=void 0!==Je.Storage&&Je.Storage)?n:Object,"function"==typeof(r=void 0!==$e.ServiceBaseUrl&&$e.ServiceBaseUrl)?r:Object])],e)}(),Ps={};r(Ps,"IdentityStorageRepository",(()=>ca),(e=>ca=e));var Ls={};r(Ls,"IdentityStorageService",(()=>na),(e=>na=e));var As={},js={};r(js,"CookieRepository",(()=>Ns),(e=>Ns=e));var xs=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ds=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Vs=function(e,t){return function(n,r){t(n,r,e)}},Ns=function(){function e(e){this.cookiesManager=e}var t;return e.prototype.get=function(e){return this.cookiesManager.get(e)},e.prototype.set=function(e,t){var n=t.value,r=t.domain,o=t.expiresMS,i=new Date((new Date).getTime()+o);this.cookiesManager.set(e,n.toString(),{domain:r,expires:i})},e.prototype.remove=function(e){this.cookiesManager.remove(e)},e=xs([Z(),Vs(0,X("Cookies")),Ds("design:paramtypes",["function"==typeof(t="undefined"!=typeof CookiesManager&&CookiesManager)?t:Object])],e)}(),Ms={};r(Ms,"WindowRepository",(()=>Hs),(e=>Hs=e));var Us=function(){return Us=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Us.apply(this,arguments)},Gs=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Fs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ws=function(e,t){return function(n,r){t(n,r,e)}},Hs=function(){function e(e){this.window=e}var t;return e.prototype.get=function(e){return this.window.fandomContext.tracking[e]},e.prototype.set=function(e,t){this.window.fandomContext&&this.window.fandomContext.tracking||(this.window.fandomContext=Us(Us({},this.window.fandomContext),{tracking:{}})),this.window.fandomContext.tracking[e]=t.value},e.prototype.remove=function(e){try{delete this.window.fandomContext.tracking[e]}catch(e){}},e=Gs([Z(),Ws(0,X("window")),Fs("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object])],e)}(),Bs={};r(Bs,"TrackingContextSetupService",(()=>Ys),(e=>Ys=e));var qs=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Qs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},zs=function(e,t){return function(n,r){t(n,r,e)}},$s=18e5,Ys=function(){function e(e,t,n,r,o,i,s){this.windowRepository=e,this.cookieRepository=t,this.uuid=n,this.beaconGenerator=r,this.pageViewNumberGenerator=o,this.window=i,this.wikiConfig=s}var t,n,r,o,i,s;return e.prototype.set=function(e,t){this.windowRepository.set(e,t),this.cookieRepository.set(e,t)},e.prototype.remove=function(e){this.windowRepository.remove(e),this.cookieRepository.remove(e)},e.prototype.setup=function(e){var t=et.TopLevelDomainExtractor.extract(e);this.windowRepository.set("pvUID",{domain:e,expiresMS:$s,value:this.wikiConfig.get("pvUID")||this.window.pvUID||this.uuid()});var n={domain:t,expiresMS:15552e6,value:this.cookieRepository.get("wikia_beacon_id")||this.cookieRepository.get("beaconId")||this.beaconGenerator.generate()};this.windowRepository.set("beaconId",n),this.cookieRepository.set("wikia_beacon_id",n);var r=this.cookieRepository.get("sessionId"),o={domain:t,expiresMS:$s,value:r||this.uuid()};this.set("sessionId",o),this.set("pvNumber",{domain:e,expiresMS:$s,value:this.pageViewNumberGenerator.getNextNumberFromCookie("pvNumber")}),this.set("pvNumberGlobal",{domain:t,expiresMS:$s,value:this.pageViewNumberGenerator.getNextNumberFromCookie("pvNumberGlobal")})},e.prototype.clear=function(){this.remove("beaconId"),this.remove("sessionId"),this.remove("pvNumber"),this.remove("pvNumberGlobal")},e=qs([ee(),zs(0,X(Ms.WindowRepository)),zs(1,X(js.CookieRepository)),zs(2,X("uuid")),zs(3,X(ut.BeaconGenerator)),zs(4,X(fs.PageViewNumberGenerator)),zs(5,X("window")),zs(6,X(rt.WikiConfig)),Qs("design:paramtypes",["function"==typeof(t=void 0!==Ms.WindowRepository&&Ms.WindowRepository)?t:Object,"function"==typeof(n=void 0!==js.CookieRepository&&js.CookieRepository)?n:Object,Function,"function"==typeof(r=void 0!==ut.BeaconGenerator&&ut.BeaconGenerator)?r:Object,"function"==typeof(o=void 0!==fs.PageViewNumberGenerator&&fs.PageViewNumberGenerator)?o:Object,"function"==typeof(i="undefined"!=typeof Window&&Window)?i:Object,"function"==typeof(s=void 0!==rt.WikiConfig&&rt.WikiConfig)?s:Object])],e)}();n(As,js),n(As,Ms),n(As,Bs);var Ks=function(){return Ks=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ks.apply(this,arguments)},Js=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Xs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Zs=function(e,t){return function(n,r){t(n,r,e)}},ea=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},ta=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},na=function(){function e(e,t,n,r,o){this.storage=e,this.logger=t,this.windowContextRepository=n,this.instantConfigService=r,this.identityStorageClient=o}var t,n,r,o,i;return e.prototype.get=function(){return ea(this,void 0,Promise,(function(){var e;return ta(this,(function(t){switch(t.label){case 0:return[4,this.getLocalData()];case 1:return(e=t.sent())&&!e.synced&&this.setRemote(e),!e||this.isDeprecated(e)?[2,this.getRemote()]:(this.setIdentityContextVariables(e),[2,e])}}))}))},e.prototype.setRemote=function(e){return ea(this,void 0,Promise,(function(){var t;return ta(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.identityStorageClient.postData(e)];case 1:return n.sent(),t=Ks(Ks({},this.identityStorageClient.getLocalData()),{synced:!0}),this.setIdentityContextVariables(t),this.identityStorageClient.setLocalData(Ks(Ks({},t),{timestamp:Date.now()})),[2,t];case 2:return n.sent(),this.logger.error("Updating Identity Storage data failed"),[3,3];case 3:return[2]}}))}))},e.prototype.isDeprecated=function(e){var t=this.instantConfigService.get("icIdentityTtl",6048e5),n=Date.now()-t;return!e.timestamp||e.timestamp-n<0},e.prototype.getLocalData=function(){return ea(this,void 0,void 0,(function(){var e,t;return ta(this,(function(n){switch(n.label){case 0:return[4,this.identityStorageClient.getLocalData()];case 1:return(e=n.sent())?[3,3]:(t=this.getLocalPPID()||this.getAdmsPPID())?[4,this.migrateDeprecatedIdentity(t)]:[3,3];case 2:e=n.sent(),n.label=3;case 3:return[2,e]}}))}))},e.prototype.migrateDeprecatedIdentity=function(e){return ea(this,void 0,void 0,(function(){var t;return ta(this,(function(n){switch(n.label){case 0:return[4,this.setRemote({ppid:e,synced:!1})];case 1:return t=n.sent(),this.clearDeprecatedLocalPpid(),[2,t]}}))}))},e.prototype.getAdmsPPID=function(){var e,t,n=this.storage.getItem("silver-surfer-active-data-v2");return null===(t=null===(e=null==n?void 0:n.IDENTITY)||void 0===e?void 0:e[0].payload)||void 0===t?void 0:t.identityToken},e.prototype.getLocalPPID=function(){return this.storage.getItem("ppid")},e.prototype.clearDeprecatedLocalPpid=function(){this.storage.removeItem("ppid")},e.prototype.getRemote=function(){return ea(this,void 0,Promise,(function(){var e;return ta(this,(function(t){switch(t.label){case 0:return[4,this.identityStorageClient.fetchData()];case 1:return e=t.sent(),this.setIdentityContextVariables(e),this.identityStorageClient.setLocalData(Ks(Ks({},e),{timestamp:Date.now()})),[2,e]}}))}))},e.prototype.setIdentityContextVariables=function(e){e.over18&&this.windowContextRepository.set("over_18",{value:"1"})},e=Js([ee(),Zs(0,X(Je.Storage)),Zs(1,te(Ge.Logger,Ge.LoggerTransformer,"UserIdentity")),Zs(2,X(Ms.WindowRepository)),Zs(3,X(ai.InstantConfigService)),Zs(4,X(Is.IdentityStorageClient)),Xs("design:paramtypes",["function"==typeof(t=void 0!==Je.Storage&&Je.Storage)?t:Object,"function"==typeof(n=void 0!==Ge.Logger&&Ge.Logger)?n:Object,"function"==typeof(r=void 0!==Ms.WindowRepository&&Ms.WindowRepository)?r:Object,"function"==typeof(o=void 0!==ai.InstantConfigService&&ai.InstantConfigService)?o:Object,"function"==typeof(i=void 0!==Is.IdentityStorageClient&&Is.IdentityStorageClient)?i:Object])],e)}(),ra=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},oa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ia=function(e,t){return function(n,r){t(n,r,e)}},sa=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},aa=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},ca=function(){function e(e,t){this.logger=e,this.identityStorageService=t}var t,n;return e.prototype.get=function(){return sa(this,void 0,Promise,(function(){var e;return aa(this,(function(t){switch(t.label){case 0:return[4,this.identityStorageService.get()];case 1:return e=t.sent(),this.logger.info(e),[2,e.ppid]}}))}))},e=ra([ee(),ia(0,te(Ge.Logger,Ge.LoggerTransformer,"UserIdentity")),ia(1,X(Ls.IdentityStorageService)),oa("design:paramtypes",["function"==typeof(t=void 0!==Ge.Logger&&Ge.Logger)?t:Object,"function"==typeof(n=void 0!==Ls.IdentityStorageService&&Ls.IdentityStorageService)?n:Object])],e)}();n(Cs,Is),n(Cs,Ps),n(Cs,Ls);var ua={};r(ua,"LocalStorageRepository",(()=>da),(e=>da=e));var la=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},pa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fa=function(e,t){return function(n,r){t(n,r,e)}},da=function(){function e(e,t,n){this.logger=e,this.uuid=t,this.storage=n}var t,n;return e.prototype.get=function(){return Promise.resolve(this.storage.getItem("ppid")||this.generatePPID())},e.prototype.generatePPID=function(){this.logger.info("did not found a PPID in LocalStorage");var e=this.uuid();return this.storage.setItem("ppid",e),e},e=la([ee(),fa(0,te(Ge.Logger,Ge.LoggerTransformer,"UserIdentity")),fa(1,X("uuid")),fa(2,X(Je.Storage)),pa("design:paramtypes",["function"==typeof(t=void 0!==Ge.Logger&&Ge.Logger)?t:Object,Function,"function"==typeof(n=void 0!==Je.Storage&&Je.Storage)?n:Object])],e)}(),ha=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},ga=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},va=function(e,t){return function(n,r){t(n,r,e)}},ya=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},ma=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},ba=function(){function e(e,t,n,r,o,i,s){this.dataWarehouse=e,this.logger=t,this.windowContextRepository=n,this.instantConfigService=r,this.identityStorageRepository=o,this.localStorageRepository=i,this.communicationService=s}var t,n,r,o,i,s,a;return e.prototype.getPPID=function(e){switch(this.logger.info("active strategy: ",e),e){case ds.IDENTITY_STORAGE:return this.identityStorageRepository;case ds.LOCAL:default:return this.localStorageRepository}},e.prototype.generatePPID=function(){return ya(this,void 0,Promise,(function(){var e,t,n;return ma(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this.instantConfigService.get("icPpidRepository",ds.LOCAL),[4,this.getPPID(e).get()];case 1:return t=r.sent(),this.dataWarehouse.track(dt.DataWarehouseEventType.identity,{partner_name:"Google",partner_identity_id:t}),this.communicationService.emit(new ir(Uo.IDENTITY_PARTNER_DATA_OBTAINED,{payload:{partnerName:"Google",partnerIdentityId:t}})),this.windowContextRepository.set("ppid",{value:t}),this.logger.info("Passed PPID to page-level targeting"),[3,3];case 2:return n=r.sent(),this.logger.error("Setting up PPID has failed!",n),[3,3];case 3:return[2]}}))}))},e.prototype.setPpid=function(){return ya(this,void 0,Promise,(function(){return ma(this,(function(e){switch(e.label){case 0:return this.instantConfigService.get("icPpid",!1)?(this.logger.info("enabled - awaiting setup"),[4,this.generatePPID()]):[3,2];case 1:return e.sent(),[3,3];case 2:this.logger.info("disabled"),e.label=3;case 3:return[2]}}))}))},e=ha([ee(),va(0,X(dt.DataWarehouseService)),va(1,te(Ge.Logger,Ge.LoggerTransformer,"UserIdentity")),va(2,X(Ms.WindowRepository)),va(3,X(ai.InstantConfigService)),va(4,X(Ps.IdentityStorageRepository)),va(5,X(ua.LocalStorageRepository)),va(6,X(sr.CommunicationService)),ga("design:paramtypes",["function"==typeof(t=void 0!==dt.DataWarehouseService&&dt.DataWarehouseService)?t:Object,"function"==typeof(n=void 0!==Ge.Logger&&Ge.Logger)?n:Object,"function"==typeof(r=void 0!==Ms.WindowRepository&&Ms.WindowRepository)?r:Object,"function"==typeof(o=void 0!==ai.InstantConfigService&&ai.InstantConfigService)?o:Object,"function"==typeof(i=void 0!==Ps.IdentityStorageRepository&&Ps.IdentityStorageRepository)?i:Object,"function"==typeof(s=void 0!==ua.LocalStorageRepository&&ua.LocalStorageRepository)?s:Object,"function"==typeof(a=void 0!==sr.CommunicationService&&sr.CommunicationService)?a:Object])],e)}();n(bs,ws),n(bs,ua),n(bs,Cs),n(ct,ut),n(ct,ft),n(ct,or),n(ct,ti),n(ct,ai),n(ct,wt),n(ct,fs),n(ct,bs),n(ct,As);var wa={};r(wa,"ConsentCallbackQueueResolver",(()=>ja),(e=>ja=e));var Sa={};r(Sa,"oneTrustCategoriesMap",(()=>Ia),(e=>Ia=e)),r(Sa,"OnetrustApiConsentResolver",(()=>Ra),(e=>Ra=e));var Ca=function(){return Ca=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ca.apply(this,arguments)},Ia={C0001:"necessary",C0002:"performance",C0003:"functional",C0004:"targeting",C0005:"social"},Ra=function(){function e(e,t){this.container=e;var n=e.OptanonWrapper;e.OptanonWrapper=function(){t.resolve(),null==n||n()}}return e.prototype.available=function(){return void 0!==this.container.OneTrust},e.prototype.ready=function(){var e,t,n=this.container.OneTrust;return void 0!==this.container.OnetrustActiveGroups&&("opt-in"!==(null===(t=null===(e=n.GetDomainData())||void 0===e?void 0:e.ConsentModel)||void 0===t?void 0:t.Name)||n.IsAlertBoxClosed())},e.prototype.resolve=function(){var e;return null===(e=this.container.OnetrustActiveGroups)||void 0===e?void 0:e.split(",").map((function(e){return Ia[e]})).filter((function(e){return e})).reduce((function(e,t){var n;return Ca(Ca({},e),((n={})[t]=!0,n))}),{})},e}(),Oa={};r(Oa,"OnetrustCookieConsentResolver",(()=>Ea),(e=>Ea=e));var _a=function(){return _a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_a.apply(this,arguments)},Ea=function(){function e(e,t){this.optIn=e,this.cookiesManager=t}return e.prototype.available=function(){return void 0!==this.cookiesManager.get("OptanonConsent")},e.prototype.ready=function(){return!this.optIn||void 0!==this.cookiesManager.get("OptanonAlertBoxClosed")},e.prototype.resolve=function(){var e,t=null===(e=decodeURIComponent(this.cookiesManager.get("OptanonConsent")))||void 0===e?void 0:e.match(/groups=([^&]+)/);return t&&t[1]?t[1].toUpperCase().split(",").map((function(e){var t=e.split(":");return"1"===t[1]?Sa.oneTrustCategoriesMap[t[0]]:void 0})).filter((function(e){return e})).reduce((function(e,t){var n;return _a(_a({},e),((n={})[t]=!0,n))}),{}):{}},e}(),ka=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ta=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Pa=function(e,t){return function(n,r){t(n,r,e)}},La={necessary:!0},Aa={necessary:!0,performance:!0,functional:!0,targeting:!0,social:!0},ja=function(){function e(e,t,n){var r,o;this.container=e,this.logger=t,this.cookiesManager=n;var i=this.cookiesManager.get("Geo");this.queue=e.consentCallbackQueue,this.optIn=!!i&&Ft.includes(null===(o=null===(r=JSON.parse(decodeURIComponent(i)))||void 0===r?void 0:r.country)||void 0===o?void 0:o.toLowerCase()),void 0!==this.queue&&this.init()}var t,n,r;return e.prototype.resolve=function(){return!!this.wasResolved()||(this.ifAvailableThenResolveIfReady(this.apiConsentResolver)?(this.logger.info("API available, resolved?:",this.categories),this.wasResolved()):!!this.ifAvailableThenResolveIfReady(this.cookieConsentResolver)&&(this.logger.info("Cookies available, resolved?:",this.categories),this.wasResolved()))},e.prototype.wasResolved=function(){return void 0!==this.categories},e.prototype.init=function(){var e=this;this.logger.info("Setting up with opt-in status:",this.optIn),this.apiConsentResolver=new(0,Sa.OnetrustApiConsentResolver)(this.container,this),this.cookieConsentResolver=new(0,Oa.OnetrustCookieConsentResolver)(this.optIn,this.cookiesManager),this.resolve()||setTimeout((function(){return e.resolveWithFallback()}),5e3)},e.prototype.resolveWithFallback=function(){var e=this;this.resolve()||(this.apiConsentResolver.available()||this.cookieConsentResolver.available()?(this.logger.info("Still waiting for consent resolve with available api:",this.apiConsentResolver.available(),"or cookie:",this.cookieConsentResolver.available()),setTimeout((function(){return e.resolveWithFallback}),5e3)):(this.categories=this.fallback(),this.logger.info("Unable to resolve consent, fallback to:",this.categories),this.resolveQueue()))},e.prototype.ifAvailableThenResolveIfReady=function(e){var t=e.available();return t&&e.ready()&&(this.categories=e.resolve(),this.resolveQueue()),t},e.prototype.checkAndRun=function(e,t,n){return this.logger.info("About to callback:",e,"for:",n,"with:",this.categories),!(void 0!==n&&!this.categories[n])&&(t(this.categories),!0)},e.prototype.resolveQueue=function(){var e=this;this.flushQueue(),this.queue.push=function(t,n,r){return e.checkAndRun(t,n,r)},this.container.consentCallback=function(t,n,r){return e.checkAndRun(t,n,r)}},e.prototype.flushQueue=function(){var e=this.queue.queue;this.logger.info("Consent resolved, flushing queue of size:",e.length);for(var t=e.length-1;t>=0;t--){var n=e[t];this.checkAndRun(n.name,n.callback,n.category)&&e.splice(t,1)}},e.prototype.fallback=function(){return this.optIn?La:Aa},e=ka([ee(),Pa(0,X("window")),Pa(1,te(Ge.Logger,Ge.LoggerTransformer,"ConsentCallbackQueueHandler")),Pa(2,X("Cookies")),Ta("design:paramtypes",["function"==typeof(t="undefined"!=typeof Window&&Window)?t:Object,"function"==typeof(n=void 0!==Ge.Logger&&Ge.Logger)?n:Object,"function"==typeof(r="undefined"!=typeof CookiesManager&&CookiesManager)?r:Object])],e)}(),xa=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Da=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Va=function(e,t){return function(n,r){t(n,r,e)}},Na=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Ma=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};J.register("Cookies",{useValue:e(ne)}),J.register("uuid",{useValue:ue}),J.register("window",{useValue:window});var Ua=function(){function e(e,t,n,r,o,i,s,a,c,u){this.communicationService=e,this.optInService=t,this.hemTrackingService=n,this.trackingContextSetupService=r,this.consentResolver=o,this.instantConfigService=i,this.window=s,this.logger=a,this.ppidProvider=c,this.consentCallbackQueueResolver=u}var t,n,r,o,i,s,a,c,u,l;return e.prototype.initializeTracking=function(){return Na(this,void 0,void 0,(function(){return Ma(this,(function(e){switch(e.label){case 0:return this.logger.info("Setting up tracking"),this.optInService.trackingAllowed=!0,this.hemTrackingService.activateTracking(),[4,this.ppidProvider.setPpid()];case 1:return e.sent(),this.communicationService.emit(new ir(Uo.IDENTITY_READY)),[2]}}))}))},e.prototype.init=function(){return Na(this,void 0,Promise,(function(){return Ma(this,(function(e){switch(e.label){case 0:return[4,this.instantConfigService.init()];case 1:return e.sent(),[2]}}))}))},e.prototype.run=function(){var e=this;this.logger.info("Starting identity engine");var t=this.window.location.hostname;this.communicationService.once(Uo.CONSENT_READY,(function(n){e.trackingContextSetupService.setup(t),e.consentResolver.resolve(n,e.initializeTracking.bind(e),(function(){e.optInService.trackingAllowed=!1,e.logger.info("Tracking rejected"),e.communicationService.emit(new ir(Uo.IDENTITY_READY))}))}))},e=xa([ee(),Va(0,X(sr.CommunicationService)),Va(1,X(rr.OptInService)),Va(2,X(ti.HemTrackingService)),Va(3,X(Bs.TrackingContextSetupService)),Va(4,X(St.ConsentResolver)),Va(5,X(ai.InstantConfigService)),Va(6,X("window")),Va(7,te(Ge.Logger,Ge.LoggerTransformer,"IdentityEngine")),Va(8,X(ws.PpidProvider)),Va(9,X(wa.ConsentCallbackQueueResolver)),Da("design:paramtypes",["function"==typeof(t=void 0!==sr.CommunicationService&&sr.CommunicationService)?t:Object,"function"==typeof(n=void 0!==rr.OptInService&&rr.OptInService)?n:Object,"function"==typeof(r=void 0!==ti.HemTrackingService&&ti.HemTrackingService)?r:Object,"function"==typeof(o=void 0!==Bs.TrackingContextSetupService&&Bs.TrackingContextSetupService)?o:Object,"function"==typeof(i=void 0!==St.ConsentResolver&&St.ConsentResolver)?i:Object,"function"==typeof(s=void 0!==ai.InstantConfigService&&ai.InstantConfigService)?s:Object,"function"==typeof(a="undefined"!=typeof Window&&Window)?a:Object,"function"==typeof(c=void 0!==Ge.Logger&&Ge.Logger)?c:Object,"function"==typeof(u=void 0!==ws.PpidProvider&&ws.PpidProvider)?u:Object,"function"==typeof(l=void 0!==wa.ConsentCallbackQueueResolver&&wa.ConsentCallbackQueueResolver)?l:Object])],e)}();!function(){Na(this,void 0,void 0,(function(){var e;return Ma(this,(function(t){return(e=J.resolve(Ua)).init().then((function(){e.run()})),[2]}))}))}()})();